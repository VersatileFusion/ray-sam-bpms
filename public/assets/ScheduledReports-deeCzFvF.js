import{y,r as b,k as F,c as o,a as e,j as c,h as v,F as M,p as j,t as i,w as P,f as d,v as D,I as k,b as G,d as q,C as I,N as T,o as a,q as A}from"./index-NaxcUE6C.js";import{a as J}from"./constants-CjjkXsVG.js";import{d as h}from"./dateUtils-B4onfrge.js";import{P as U}from"./PersianDatePicker-DxPeU3f5.js";import{S as m}from"./sweetalert2.esm.all-ePrzfkxH.js";const x={async getScheduledReports(){return(await y.get("/scheduled-reports")).data},async getScheduledReport(r){return(await y.get(`/scheduled-reports/${r}`)).data},async createScheduledReport(r){return(await y.post("/scheduled-reports",r)).data},async updateScheduledReport(r,u){return(await y.put(`/scheduled-reports/${r}`,u)).data},async deleteScheduledReport(r){return(await y.delete(`/scheduled-reports/${r}`)).data},async runScheduledReport(r){return(await y.post(`/scheduled-reports/${r}/run`)).data}},K={class:"mb-6 flex justify-between items-center"},O={class:"card"},Q={key:0,class:"text-center py-20"},W={key:1,class:"text-center py-20 text-gray-500"},X={key:2,class:"space-y-4"},Z={class:"flex justify-between items-start mb-4"},ee={class:"flex-1"},te={class:"flex items-center gap-3 mb-2"},se={class:"text-xl font-bold text-gray-900"},le={class:"badge badge-info"},ne={key:0,class:"text-gray-600 mb-2"},oe={class:"flex items-center gap-4 text-sm text-gray-500"},ae={key:0},ie={class:"flex gap-2"},re=["onClick"],de=["onClick"],ue={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ce={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ve=["onClick"],pe=["onClick"],me={class:"mt-4 pt-4 border-t border-gray-200"},fe={class:"text-sm text-gray-600 mb-2"},ye={key:0},be={key:1},xe={key:2},ge={class:"text-sm text-gray-500"},we={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ke={class:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto"},he={class:"text-2xl font-bold text-gray-900 mb-4"},Ce={class:"space-y-4"},Be={class:"grid grid-cols-2 gap-4"},De={key:0},Se={key:1},Re={class:"grid grid-cols-2 gap-4"},Ve={class:"grid grid-cols-2 gap-4"},Me=["value"],je={class:"flex items-center gap-4"},qe={class:"flex items-center"},Te={class:"flex items-center"},Ae={class:"flex justify-end space-x-4 space-x-reverse mt-6"},Ue=["disabled"],_e={key:0,class:"mr-2"},Ne={__name:"ScheduledReports",setup(r){const u=b(!1),g=b(!1),C=b(!1),p=b(null),S=b([]),l=b({name:"",description:"",type:"",schedule:{frequency:"",day:void 0,time:"09:00"},filters:{startDate:"",endDate:"",status:"",system:""},isActive:!0}),_=n=>({excel:"Excel",csv:"CSV",advanced:"پیشرفته"})[n]||n,E=n=>({daily:"روزانه",weekly:"هفتگی",monthly:"ماهانه"})[n]||n,R=n=>n?h.formatDate(n,"jYYYY/jMM/jDD HH:mm"):"",$=()=>{l.value.schedule.frequency==="weekly"?l.value.schedule.day=0:l.value.schedule.frequency==="monthly"?l.value.schedule.day=1:l.value.schedule.day=void 0},V=()=>{C.value=!1,p.value=null,l.value={name:"",description:"",type:"",schedule:{frequency:"",day:void 0,time:"09:00"},filters:{startDate:"",endDate:"",status:"",system:""},isActive:!0}},z=n=>{var t,s,w,f;p.value=n._id,l.value={name:n.name,description:n.description||"",type:n.type,schedule:{frequency:n.schedule.frequency,day:n.schedule.day,time:n.schedule.time},filters:{startDate:(t=n.filters)!=null&&t.startDate?h.gregorianToJalali(n.filters.startDate):"",endDate:(s=n.filters)!=null&&s.endDate?h.gregorianToJalali(n.filters.endDate):"",status:((w=n.filters)==null?void 0:w.status)||"",system:((f=n.filters)==null?void 0:f.system)||""},isActive:n.isActive},C.value=!0},H=async()=>{var n,t;g.value=!0;try{const s={...l.value,filters:{startDate:l.value.filters.startDate?h.jalaliToGregorian(l.value.filters.startDate):void 0,endDate:l.value.filters.endDate?h.jalaliToGregorian(l.value.filters.endDate):void 0,status:l.value.filters.status||void 0,system:l.value.filters.system||void 0}};p.value?await x.updateScheduledReport(p.value,s):await x.createScheduledReport(s),await m.fire({icon:"success",title:"موفقیت‌آمیز!",text:p.value?"گزارش با موفقیت ویرایش شد":"گزارش با موفقیت ایجاد شد",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"}),V(),await B()}catch(s){console.error("Error saving report:",s),await m.fire({icon:"error",title:"خطا!",text:((t=(n=s.response)==null?void 0:n.data)==null?void 0:t.message)||"خطا در ذخیره گزارش",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{g.value=!1}},L=async n=>{try{await x.updateScheduledReport(n._id,{isActive:!n.isActive}),await B()}catch(t){console.error("Error toggling report:",t)}},N=async n=>{try{await x.runScheduledReport(n._id),await m.fire({icon:"success",title:"موفقیت‌آمیز!",text:"گزارش در صف اجرا قرار گرفت",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(t){console.error("Error running report:",t),await m.fire({icon:"error",title:"خطا!",text:"خطا در اجرای گزارش",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}},Y=async n=>{if((await m.fire({title:"آیا از حذف این گزارش اطمینان دارید؟",text:"این عملیات قابل برگشت نیست.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، حذف کن",cancelButtonText:"لغو",reverseButtons:!0})).isConfirmed)try{await x.deleteScheduledReport(n),await m.fire({icon:"success",title:"موفقیت‌آمیز!",text:"گزارش با موفقیت حذف شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"}),await B()}catch(s){console.error("Error deleting report:",s),await m.fire({icon:"error",title:"خطا!",text:"خطا در حذف گزارش",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}},B=async()=>{u.value=!0;try{const n=await x.getScheduledReports();n.success&&(S.value=n.reports||[])}catch(n){console.error("Error loading reports:",n)}finally{u.value=!1}};return F(async()=>{await B()}),(n,t)=>(a(),o("div",null,[e("div",K,[t[15]||(t[15]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"گزارش‌های زمان‌بندی شده"),e("p",{class:"text-gray-600 mt-2"},"مدیریت گزارش‌های خودکار")],-1)),e("button",{onClick:t[0]||(t[0]=s=>C.value=!0),class:"btn btn-primary"},[...t[14]||(t[14]=[e("svg",{class:"w-5 h-5 inline ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),v(" گزارش جدید ",-1)])])]),e("div",O,[u.value?(a(),o("div",Q,[...t[16]||(t[16]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1)])])):S.value.length===0?(a(),o("div",W,[...t[17]||(t[17]=[e("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("p",null,"گزارش زمان‌بندی شده‌ای ثبت نشده است",-1)])])):(a(),o("div",X,[(a(!0),o(M,null,j(S.value,s=>{var w;return a(),o("div",{key:s._id,class:"border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow"},[e("div",Z,[e("div",ee,[e("div",te,[e("h3",se,i(s.name),1),e("span",{class:A(s.isActive?"badge badge-success":"badge badge-danger")},i(s.isActive?"فعال":"غیرفعال"),3),e("span",le,i(_(s.type)),1)]),s.description?(a(),o("p",ne,i(s.description),1)):c("",!0),e("div",oe,[e("span",null,"فرکانس: "+i(E(s.schedule.frequency)),1),e("span",null,"زمان: "+i(s.schedule.time),1),e("span",null,"تعداد اجرا: "+i(s.runCount||0),1),s.lastRun?(a(),o("span",ae,"آخرین اجرا: "+i(R(s.lastRun)),1)):c("",!0)])]),e("div",ie,[e("button",{onClick:f=>z(s),class:"text-blue-600 hover:text-blue-900"},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,re),e("button",{onClick:f=>L(s),class:A(s.isActive?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900")},[s.isActive?(a(),o("svg",ue,[...t[19]||(t[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(a(),o("svg",ce,[...t[20]||(t[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"},null,-1)])]))],10,de),e("button",{onClick:f=>N(s),class:"text-green-600 hover:text-green-900"},[...t[21]||(t[21]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,ve),e("button",{onClick:f=>Y(s._id),class:"text-red-600 hover:text-red-900"},[...t[22]||(t[22]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,pe)])]),e("div",me,[e("p",fe,[t[23]||(t[23]=e("strong",null,"فیلترها:",-1)),s.filters.status?(a(),o("span",ye," وضعیت: "+i(s.filters.status),1)):c("",!0),s.filters.system?(a(),o("span",be,"، سیستم: "+i(s.filters.system),1)):c("",!0),!s.filters.status&&!s.filters.system?(a(),o("span",xe,"بدون فیلتر")):c("",!0)]),e("p",ge," ایجاد شده توسط: "+i((w=s.createdBy)==null?void 0:w.name)+" • اجرای بعدی: "+i(s.nextRun?R(s.nextRun):"محاسبه نشده"),1)])])}),128))]))]),C.value?(a(),o("div",we,[e("div",ke,[e("h2",he,i(p.value?"ویرایش گزارش":"گزارش زمان‌بندی شده جدید"),1),e("form",{onSubmit:P(H,["prevent"])},[e("div",Ce,[e("div",null,[t[24]||(t[24]=e("label",{class:"label"},[v("نام گزارش "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),type:"text",class:"input",required:""},null,512),[[D,l.value.name]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"label"},"توضیحات",-1)),d(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.description=s),class:"input",rows:"2"},null,512),[[D,l.value.description]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"label"},[v("نوع گزارش "),e("span",{class:"text-red-500"},"*")],-1)),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.type=s),class:"input",required:""},[...t[26]||(t[26]=[e("option",{value:""},"انتخاب کنید",-1),e("option",{value:"excel"},"Excel",-1),e("option",{value:"csv"},"CSV",-1),e("option",{value:"advanced"},"گزارش پیشرفته",-1)])],512),[[k,l.value.type]])]),e("div",Be,[e("div",null,[t[29]||(t[29]=e("label",{class:"label"},[v("فرکانس "),e("span",{class:"text-red-500"},"*")],-1)),d(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.schedule.frequency=s),class:"input",required:"",onChange:$},[...t[28]||(t[28]=[e("option",{value:""},"انتخاب کنید",-1),e("option",{value:"daily"},"روزانه",-1),e("option",{value:"weekly"},"هفتگی",-1),e("option",{value:"monthly"},"ماهانه",-1)])],544),[[k,l.value.schedule.frequency]])]),l.value.schedule.frequency==="weekly"?(a(),o("div",De,[t[31]||(t[31]=e("label",{class:"label"},[v("روز هفته "),e("span",{class:"text-red-500"},"*")],-1)),d(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.schedule.day=s),class:"input",required:""},[...t[30]||(t[30]=[G('<option value="0">یکشنبه</option><option value="1">دوشنبه</option><option value="2">سه‌شنبه</option><option value="3">چهارشنبه</option><option value="4">پنج‌شنبه</option><option value="5">جمعه</option><option value="6">شنبه</option>',7)])],512),[[k,l.value.schedule.day,void 0,{number:!0}]])])):c("",!0),l.value.schedule.frequency==="monthly"?(a(),o("div",Se,[t[32]||(t[32]=e("label",{class:"label"},[v("روز ماه "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.schedule.day=s),type:"number",min:"1",max:"31",class:"input",required:""},null,512),[[D,l.value.schedule.day,void 0,{number:!0}]])])):c("",!0),e("div",null,[t[33]||(t[33]=e("label",{class:"label"},[v("زمان "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.schedule.time=s),type:"time",class:"input",required:""},null,512),[[D,l.value.schedule.time]])])]),e("div",Re,[e("div",null,[t[34]||(t[34]=e("label",{class:"label"},"از تاریخ",-1)),q(U,{modelValue:l.value.filters.startDate,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.filters.startDate=s),placeholder:"1403/01/01"},null,8,["modelValue"])]),e("div",null,[t[35]||(t[35]=e("label",{class:"label"},"تا تاریخ",-1)),q(U,{modelValue:l.value.filters.endDate,"onUpdate:modelValue":t[9]||(t[9]=s=>l.value.filters.endDate=s),placeholder:"1403/12/29"},null,8,["modelValue"])])]),e("div",Ve,[e("div",null,[t[37]||(t[37]=e("label",{class:"label"},"وضعیت",-1)),d(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>l.value.filters.status=s),class:"input"},[...t[36]||(t[36]=[e("option",{value:""},"همه",-1),e("option",{value:"باز"},"باز",-1),e("option",{value:"در درست اقدام"},"در درست اقدام",-1),e("option",{value:"انجام"},"انجام",-1)])],512),[[k,l.value.filters.status]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"label"},"سیستم",-1)),d(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>l.value.filters.system=s),class:"input"},[t[38]||(t[38]=e("option",{value:""},"همه",-1)),(a(!0),o(M,null,j(I(J),s=>(a(),o("option",{key:s,value:s},i(s),9,Me))),128))],512),[[k,l.value.filters.system]])])]),e("div",null,[t[42]||(t[42]=e("label",{class:"label"},"فعال/غیرفعال",-1)),e("div",je,[e("label",qe,[d(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>l.value.isActive=s),type:"radio",value:!0,class:"ml-2"},null,512),[[T,l.value.isActive]]),t[40]||(t[40]=e("span",null,"فعال",-1))]),e("label",Te,[d(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>l.value.isActive=s),type:"radio",value:!1,class:"ml-2"},null,512),[[T,l.value.isActive]]),t[41]||(t[41]=e("span",null,"غیرفعال",-1))])])])]),e("div",Ae,[e("button",{type:"button",onClick:V,class:"btn btn-secondary"}," انصراف "),e("button",{type:"submit",class:"btn btn-primary",disabled:g.value},[g.value?(a(),o("span",_e,[...t[43]||(t[43]=[e("span",{class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):c("",!0),v(" "+i(p.value?"ویرایش":"ایجاد"),1)],8,Ue)])],32)])])):c("",!0)]))}};export{Ne as default};
