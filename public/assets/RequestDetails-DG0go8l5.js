import{r as x,k as re,c as l,o as a,a as e,F as q,p as B,q as K,j as y,t as n,y as he,B as R,D as ae,w as O,u as we,z as ke,i as _e,d as L,e as qe,E as Be,h as T,f as w,v as E,K as A,H as oe}from"./index-B1RxePN7.js";import{d as I}from"./dateUtils-KBV2qcdl.js";import{u as De}from"./requests-LaLDb1DC.js";import{u as Ce}from"./users-D1WZpKAU.js";import{b as je,R as Se,S as F}from"./constants-CFvVWKro.js";import{S as M}from"./sweetalert2.esm.all-ePrzfkxH.js";const Te={class:"space-y-4"},$e={key:0,class:"text-center py-8"},Ee={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Me={key:2,class:"relative"},Ue={class:"space-y-6"},Re={class:"flex-1 min-w-0 bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700"},Ne={class:"flex items-start justify-between"},Ve={class:"flex-1"},Ae={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ie={key:0,class:"mt-2 text-xs text-gray-600 dark:text-gray-400"},Pe={key:0},Ye={key:1},Oe={class:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap mr-3"},He={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ze={__name:"ActivityTimeline",props:{requestId:{type:String,required:!0}},setup(k){const N=k,v=x([]),p=x(!1),b=i=>({created:"bg-green-100 dark:bg-green-900/30",updated:"bg-blue-100 dark:bg-blue-900/30",status_changed:"bg-purple-100 dark:bg-purple-900/30",assigned:"bg-yellow-100 dark:bg-yellow-900/30",comment_added:"bg-indigo-100 dark:bg-indigo-900/30",closed:"bg-gray-100 dark:bg-gray-700",reopened:"bg-orange-100 dark:bg-orange-900/30"})[i]||"bg-gray-100 dark:bg-gray-700",_=i=>i?I.formatDate(i,"jYYYY/jMM/jDD HH:mm"):"",d=async()=>{p.value=!0;try{const i=await he.get(`/requests/${N.requestId}/activities`);i.data.success&&(v.value=i.data.data||[])}catch(i){console.error("Error loading activities:",i)}finally{p.value=!1}};return re(()=>{d()}),(i,c)=>(a(),l("div",Te,[c[4]||(c[4]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-4"},"زمان‌خط فعالیت",-1)),p.value?(a(),l("div",$e,[...c[0]||(c[0]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):v.value.length===0?(a(),l("div",Ee,[...c[1]||(c[1]=[e("p",null,"فعالیتی ثبت نشده است",-1)])])):(a(),l("div",Me,[c[3]||(c[3]=e("div",{class:"absolute right-4 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700"},null,-1)),e("div",Ue,[(a(!0),l(q,null,B(v.value,m=>{var h;return a(),l("div",{key:m._id,class:"relative flex items-start space-x-4 space-x-reverse"},[e("div",{class:K(["relative z-10 flex items-center justify-center w-8 h-8 rounded-full",b(m.action)])},[...c[2]||(c[2]=[e("div",{class:"w-3 h-3 rounded-full bg-white dark:bg-gray-800"},null,-1)])],2),e("div",Re,[e("div",Ne,[e("div",Ve,[e("p",Ae,n(m.description),1),m.changes&&Object.keys(m.changes).length>0?(a(),l("div",Ie,[(a(!0),l(q,null,B(m.changes,(g,f)=>(a(),l("span",{key:f,class:"mr-3"},[e("strong",null,n(f)+":",1),typeof g=="object"?(a(),l("span",Pe,n(g.from)+" → "+n(g.to),1)):(a(),l("span",Ye,n(g),1))]))),128))])):y("",!0)]),e("span",Oe,n(_(m.createdAt)),1)]),e("div",He," توسط: "+n(((h=m.performedBy)==null?void 0:h.name)||"سیستم"),1)])])}),128))])]))]))}},Le={class:"relative max-w-7xl max-h-full"},Fe=["src","alt"],Ke={key:0,class:"absolute inset-0 flex items-center justify-between p-4 pointer-events-none"},Ge={__name:"ImagePreview",props:{isOpen:{type:Boolean,default:!1},imageUrl:{type:String,required:!0},images:{type:Array,default:null},alt:{type:String,default:"تصویر"},navigation:{type:Boolean,default:!1}},emits:["close","update:isOpen"],setup(k,{emit:N}){const v=k,p=N,b=x(0),_=x(!1);R(()=>{var g;return v.images&&v.images.length>0?((g=v.images[b.value])==null?void 0:g.url)||v.images[b.value]:v.imageUrl});const d=()=>{_.value=!0},i=()=>{b.value>0&&(b.value--,_.value=!1)},c=()=>{v.images&&b.value<v.images.length-1&&(b.value++,_.value=!1)},m=()=>{p("close"),p("update:isOpen",!1)},h=g=>{v.isOpen&&(g.key==="Escape"?m():g.key==="ArrowLeft"&&v.navigation&&v.images?i():g.key==="ArrowRight"&&v.navigation&&v.images&&c())};return ae(()=>v.isOpen,g=>{g?(document.addEventListener("keydown",h),b.value=0,_.value=!1):document.removeEventListener("keydown",h)}),ae(()=>v.imageUrl,()=>{b.value=0,_.value=!1}),(g,f)=>k.isOpen?(a(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 z-[9999] flex items-center justify-center p-4",onClick:O(m,["self"])},[e("div",Le,[e("button",{onClick:m,class:"absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors"},[...f[0]||(f[0]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),e("img",{src:k.imageUrl,alt:k.alt,class:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",onError:d},null,40,Fe),k.navigation&&k.images&&k.images.length>1?(a(),l("div",Ke,[b.value>0?(a(),l("button",{key:0,onClick:i,class:"pointer-events-auto bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2 text-white transition-all"},[...f[1]||(f[1]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):y("",!0),b.value<k.images.length-1?(a(),l("button",{key:1,onClick:c,class:"pointer-events-auto bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2 text-white transition-all"},[...f[2]||(f[2]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):y("",!0)])):y("",!0)])])):y("",!0)}},Je={key:0,class:"text-center py-20"},Qe={key:1},We={class:"mb-6 flex justify-between items-center"},Xe={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ze={class:"md:col-span-2 space-y-6"},et={class:"rounded-3xl border border-gray-100 bg-gradient-to-br from-white via-white to-gray-50 p-6 shadow-sm"},tt={class:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},st={class:"mt-2 text-xl font-extrabold text-gray-900 md:text-2xl"},lt={class:"mt-1 text-sm text-gray-500"},at={class:"flex flex-wrap items-center gap-2"},ot={class:"inline-flex items-center rounded-full border border-amber-100 bg-amber-50 px-3 py-1 text-xs font-semibold text-amber-600"},rt={class:"inline-flex items-center rounded-full border border-blue-100 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-600"},nt={class:"mt-6 grid grid-cols-1 gap-4 md:grid-cols-2"},it={class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},ut={class:"text-sm font-medium text-gray-900"},dt={class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},ct={class:"text-sm font-medium text-gray-900"},vt={key:0,class:"text-xs text-gray-500"},pt={class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},gt={class:"text-sm font-medium text-gray-900"},mt={class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},yt={class:"text-sm font-medium text-gray-900"},xt={key:0,class:"text-xs text-gray-500"},bt={class:"mt-6 grid grid-cols-1 gap-4"},ft={class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},ht={class:"whitespace-pre-wrap text-sm leading-6 text-gray-700"},wt={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},kt={class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},_t={class:"whitespace-pre-wrap text-sm leading-6 text-gray-700"},qt={key:0,class:"space-y-2 rounded-2xl border border-gray-100 bg-white/70 p-4"},Bt={class:"whitespace-pre-wrap text-sm leading-6 text-gray-700"},Dt={class:"card"},Ct={class:"card"},jt={class:"mb-6"},St={class:"flex gap-2"},Tt=["disabled"],$t={key:0,class:"space-y-4"},Et={class:"flex justify-between items-start mb-2"},Mt={class:"font-medium text-gray-900"},Ut={class:"text-sm text-gray-500"},Rt={class:"text-gray-700 whitespace-pre-wrap"},Nt={key:1,class:"text-gray-500 text-center py-8"},Vt={class:"card"},At={key:0,class:"mb-4"},It={class:"flex gap-2"},Pt=["disabled"],Yt={key:1,class:"space-y-2"},Ot={class:"flex items-center gap-3"},Ht={key:0,class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},zt=["src","onClick","alt"],Lt={class:"font-medium text-gray-900 dark:text-gray-100"},Ft={class:"text-xs text-gray-500 dark:text-gray-400"},Kt={class:"flex items-center gap-2"},Gt=["onClick"],Jt=["href"],Qt={key:2,class:"text-gray-500 text-center py-8"},Wt={class:"space-y-6"},Xt={class:"card"},Zt={class:"space-y-4"},es={key:0},ts=["disabled"],ss=["disabled"],ls={class:"font-medium"},as={key:1},os={class:"font-medium"},rs={key:2},ns=["disabled"],is=["value"],us=["disabled"],ds={key:0,class:"card"},cs={class:"space-y-3"},vs={key:1,class:"card"},ps=["value"],gs=["value"],ms={class:"flex gap-2"},ys=["disabled"],xs={class:"card"},bs={class:"space-y-3 text-sm"},fs={class:"font-medium"},hs={class:"font-medium"},ws={class:"text-xs text-gray-500"},ks={class:"card"},_s={class:"flex justify-between items-center mb-4"},qs={key:0},Bs={key:0,class:"text-center py-4"},Ds={key:1,class:"text-gray-500 text-center py-4"},Cs={key:2,class:"space-y-3 max-h-64 overflow-y-auto"},js={class:"flex justify-between items-start mb-2"},Ss={class:"font-medium text-gray-900"},Ts={class:"text-xs text-gray-500"},$s={class:"space-y-1 text-sm"},Es={class:"text-gray-600"},Ms={class:"line-through text-red-500 ml-2"},Us={class:"text-green-600"},Rs={key:2,class:"text-center py-20"},Os={__name:"RequestDetails",setup(k){const N=ke(),v=_e(),p=De(),b=we(),_=Ce(),d=x(!1),i=R(()=>N.params.id),c=x(""),m=x(""),h=x(!1),g=x(!1),f=x(!1),P=x([]),H=x(null),V=x(null),D=x(""),G=x(!1),ne=x(""),o=R(()=>p.currentRequest),C=R(()=>b.user),ie=R(()=>_.users),ue=R(()=>ie.value.filter(r=>(r.role==="admin"||r.role==="user"||r.role==="specialist")&&r.isActive!==!1)),u=x({customerName:"",customerPhone:"",userName:"",system:"",requestType:"",priority:"",request:"",actionDescription:"",closeDescription:""}),J=r=>({[F.OPEN]:"badge badge-info",[F.IN_PROGRESS]:"badge badge-warning",[F.COMPLETED]:"badge badge-success"})[r]||"badge badge-secondary",$=(r,t=!0)=>{if(!r)return"";const j=t?"jYYYY/jMM/jDD HH:mm":"jYYYY/jMM/jDD";if(typeof r=="string"&&/^\d{4}[-/]\d{2}[-/]\d{2}$/.test(r)){const S=r.replace(/-/g,"/");return t?`${I.gregorianToJalali(S)} 00:00`:I.gregorianToJalali(S)}return I.formatDate(r,j)},de=r=>r?I.getRelativeTime(r):"",ce=async()=>{if(!(!c.value||c.value===o.value.status||!(await M.fire({title:"آیا از تغییر وضعیت اطمینان دارید؟",text:"این عملیات قابل برگشت نیست.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، تغییر دهید",cancelButtonText:"لغو",reverseButtons:!0})).isConfirmed)){d.value=!0;try{await p.updateRequest(i.value,{status:c.value}),await p.fetchRequest(i.value),c.value="",await M.fire({icon:"success",title:"موفقیت‌آمیز!",text:"وضعیت درخواست با موفقیت تغییر کرد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(t){console.error("Error updating status:",t),await M.fire({icon:"error",title:"خطا!",text:"خطا در تغییر وضعیت",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}},ve=async()=>{if(!(!m.value||!m.value.trim())){d.value=!0;try{const r=await p.addComment(i.value,m.value);m.value="",await p.fetchRequest(i.value)}catch(r){console.error("Error adding comment:",r),await M.fire({icon:"error",title:"خطا!",text:"خطا در ثبت نظر",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}},Q=()=>{h.value||(u.value={customerName:o.value.customerName||"",customerPhone:o.value.customerPhone||"",userName:o.value.userName||"",system:o.value.system||"",requestType:o.value.requestType||"",priority:o.value.priority||"",request:o.value.request||"",actionDescription:o.value.actionDescription||"",closeDescription:o.value.closeDescription||""}),h.value=!h.value},pe=async()=>{d.value=!0;try{const r={customerPhone:u.value.customerPhone,requestType:u.value.requestType,priority:u.value.priority,request:u.value.request,actionDescription:u.value.actionDescription,closeDescription:u.value.closeDescription};await p.updateRequest(i.value,r),h.value=!1,await p.fetchRequest(i.value)}catch(r){console.error("Error updating request:",r),await M.fire({icon:"error",title:"خطا!",text:"خطا در ویرایش درخواست",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}},ge=async()=>{if(g.value=!g.value,g.value&&P.value.length===0){f.value=!0;try{const r=await p.getRequestHistory(i.value);P.value=r}catch(r){console.error("Error loading history:",r)}finally{f.value=!1}}},me=r=>{V.value=r.target.files[0]},ye=async()=>{if(V.value){d.value=!0;try{await p.uploadAttachment(i.value,V.value),V.value=null,H.value&&(H.value.value=""),await p.fetchRequest(i.value)}catch(r){console.error("Error uploading attachment:",r),await M.fire({icon:"error",title:"خطا!",text:"خطا در آپلود فایل",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}},xe=r=>{if(!r)return"0 B";const t=1024,j=["B","KB","MB","GB"],S=Math.floor(Math.log(r)/Math.log(t));return Math.round(r/Math.pow(t,S)*100)/100+" "+j[S]},be=async()=>{if(D.value){d.value=!0;try{await p.assignRequest(i.value,D.value),await p.fetchRequest(i.value),D.value=""}catch(r){console.error("Error assigning request:",r),await M.fire({icon:"error",title:"خطا!",text:"خطا در اختصاص درخواست",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}};return re(async()=>{var r,t,j;d.value=!0;try{((r=C.value)==null?void 0:r.role)!=="customer"&&await _.fetchUsers(),await p.fetchRequest(i.value),o.value&&(c.value=o.value.status,D.value=((t=o.value.assignedTo)==null?void 0:t.userId)||""),o.value&&((j=C.value)==null?void 0:j.role)==="customer"&&o.value.createdBy.userId!==C.value._id&&v.push("/requests")}finally{d.value=!1}}),(r,t)=>{var S,W,X,Z,ee,te,se,le;const j=Be("router-link");return a(),l("div",null,[d.value?(a(),l("div",Je,[...t[13]||(t[13]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1)])])):o.value?(a(),l("div",Qe,[e("div",We,[t[15]||(t[15]=e("h1",{class:"text-3xl font-bold text-gray-900"},"جزئیات درخواست",-1)),L(j,{to:"/requests",class:"btn btn-secondary"},{default:qe(()=>[...t[14]||(t[14]=[T(" بازگشت به لیست ",-1)])]),_:1})]),e("div",Xe,[e("div",Ze,[e("div",et,[e("header",tt,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-xs font-semibold uppercase tracking-widest text-primary-500"},"اطلاعات درخواست",-1)),e("h2",st,n(o.value.requestType||"درخواست ثبت‌شده"),1),e("p",lt," ثبت شده توسط "+n(o.value.userName||"نامشخص")+" در "+n($(o.value.createdAt||o.value.date)),1)]),e("div",at,[e("span",{class:K([J(o.value.status),"inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold"])},n(o.value.status||"نامشخص"),3),e("span",ot," اولویت: "+n(o.value.priority||"—"),1),e("span",rt," سیستم: "+n(o.value.system||"—"),1)])]),e("div",nt,[e("div",it,[t[17]||(t[17]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-slate-100 text-slate-600"},"ت"),T(" تاریخ ثبت ")],-1)),e("dd",ut,n($(o.value.date,!1)),1)]),e("div",dt,[t[18]||(t[18]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-emerald-100 text-emerald-600"},"م"),T(" نام مشتری ")],-1)),e("dd",ct,n(o.value.customerName||"نامشخص"),1),o.value.customerPhone?(a(),l("dd",vt,n(o.value.customerPhone),1)):y("",!0)]),e("div",pt,[t[19]||(t[19]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-indigo-100 text-indigo-600"},"ن"),T(" نوع درخواست ")],-1)),e("dd",gt,n(o.value.requestType||"—"),1)]),e("div",mt,[t[20]||(t[20]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-purple-100 text-purple-600"},"ا"),T(" اختصاص داده شده به ")],-1)),e("dd",yt,n(((S=o.value.assignedTo)==null?void 0:S.name)||"اختصاص داده نشده"),1),o.value.dueDate?(a(),l("dd",xt,"سررسید: "+n($(o.value.dueDate)),1)):y("",!0)])]),e("div",bt,[e("div",ft,[t[21]||(t[21]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-blue-100 text-blue-600"},"د"),T(" شرح درخواست ")],-1)),e("dd",ht,n(o.value.request||"—"),1)]),e("div",wt,[e("div",kt,[t[22]||(t[22]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-green-100 text-green-600"},"ا"),T(" اقدام انجام شده ")],-1)),e("dd",_t,n(o.value.actionDescription||"—"),1)]),o.value.closeDescription?(a(),l("div",qt,[t[23]||(t[23]=e("dt",{class:"flex items-center gap-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"},[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-rose-100 text-rose-600"},"ب"),T(" نتیجه نهایی ")],-1)),e("dd",Bt,n(o.value.closeDescription),1)])):y("",!0)])])]),e("div",Dt,[L(ze,{"request-id":o.value._id},null,8,["request-id"])]),e("div",Ct,[t[24]||(t[24]=e("h2",{class:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4"},"نظرات",-1)),e("div",jt,[e("form",{onSubmit:O(ve,["prevent"])},[e("div",St,[w(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),class:"input flex-1",rows:"3",placeholder:"نظر خود را بنویسید...",required:""},null,512),[[E,m.value]]),e("button",{type:"submit",class:"btn btn-primary px-4",disabled:d.value}," ارسال ",8,Tt)])],32)]),o.value.comments&&o.value.comments.length>0?(a(),l("div",$t,[(a(!0),l(q,null,B(o.value.comments,s=>{var U;return a(),l("div",{key:s._id||((U=s._id)==null?void 0:U.toString())||Math.random(),class:"border-b border-gray-200 pb-4"},[e("div",Et,[e("span",Mt,n(s.createdBy.name),1),e("span",Ut,n($(s.createdAt)),1)]),e("p",Rt,n(s.text),1)])}),128))])):(a(),l("div",Nt," نظری ثبت نشده است "))]),e("div",Vt,[t[26]||(t[26]=e("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"پیوست‌ها",-1)),((W=C.value)==null?void 0:W.role)!=="customer"?(a(),l("div",At,[e("form",{onSubmit:O(ye,["prevent"])},[e("div",It,[e("input",{ref_key:"fileInput",ref:H,type:"file",class:"input flex-1",onChange:me,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},null,544),e("button",{type:"submit",class:"btn btn-primary px-4",disabled:d.value||!V.value}," آپلود ",8,Pt)])],32)])):y("",!0),o.value.attachments&&o.value.attachments.length>0?(a(),l("div",Yt,[(a(!0),l(q,null,B(o.value.attachments,(s,U)=>(a(),l("div",{key:U,class:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800"},[e("div",Ot,[r.isImage(s.mimetype)?(a(),l("img",{key:1,src:`/uploads/${s.filename}`,onClick:Y=>r.openImagePreview(`/uploads/${s.filename}`),class:"w-12 h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",alt:s.originalName},null,8,zt)):(a(),l("svg",Ht,[...t[25]||(t[25]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])),e("div",null,[e("p",Lt,n(s.originalName),1),e("p",Ft,n(xe(s.size)),1)])]),e("div",Kt,[r.isImage(s.mimetype)?(a(),l("button",{key:0,onClick:Y=>r.openImagePreview(`/uploads/${s.filename}`),class:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 text-sm px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20"}," مشاهده ",8,Gt)):y("",!0),e("a",{href:`/uploads/${s.filename}`,target:"_blank",class:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 text-sm px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20",download:""}," دانلود ",8,Jt)])]))),128))])):(a(),l("div",Qt," پیوستی وجود ندارد "))])]),e("div",Wt,[e("div",Xt,[t[33]||(t[33]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"وضعیت",-1)),e("div",Zt,[e("div",null,[e("span",{class:K([J(o.value.status),"block text-center"])},n(o.value.status),3)]),((X=C.value)==null?void 0:X.role)!=="customer"?(a(),l("div",es,[t[28]||(t[28]=e("label",{class:"label"},"تغییر وضعیت",-1)),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>c.value=s),class:"input",disabled:d.value},[...t[27]||(t[27]=[e("option",{value:""},"انتخاب کنید",-1),e("option",{value:"باز"},"باز",-1),e("option",{value:"در درست اقدام"},"در درست اقدام",-1),e("option",{value:"انجام"},"انجام",-1)])],8,ts),[[A,c.value]]),c.value&&c.value!==o.value.status?(a(),l("button",{key:0,onClick:ce,class:"btn btn-success w-full mt-2 text-sm",disabled:d.value}," تغییر وضعیت ",8,ss)):y("",!0)])):y("",!0),e("div",null,[t[29]||(t[29]=e("label",{class:"text-sm text-gray-600"},"اولویت:",-1)),e("p",ls,n(o.value.priority),1)]),o.value.dueDate?(a(),l("div",as,[t[30]||(t[30]=e("label",{class:"text-sm text-gray-600"},"تاریخ سررسید:",-1)),e("p",os,n($(o.value.dueDate,!1)),1)])):y("",!0),((Z=C.value)==null?void 0:Z.role)!=="customer"?(a(),l("div",rs,[t[32]||(t[32]=e("label",{class:"label"},"اختصاص به:",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>D.value=s),class:"input",disabled:d.value},[t[31]||(t[31]=e("option",{value:""},"انتخاب کنید",-1)),(a(!0),l(q,null,B(ue.value,s=>(a(),l("option",{key:s._id,value:s._id},n(s.name),9,is))),128))],8,ns),[[A,D.value]]),D.value&&D.value!==((ee=o.value.assignedTo)==null?void 0:ee.userId)?(a(),l("button",{key:0,onClick:be,class:"btn btn-primary w-full mt-2 text-sm",disabled:d.value}," اختصاص درخواست ",8,us)):y("",!0)])):y("",!0)])]),((te=C.value)==null?void 0:te.role)!=="customer"?(a(),l("div",ds,[t[34]||(t[34]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"عملیات سریع",-1)),e("div",cs,[e("button",{onClick:Q,class:"btn btn-secondary w-full"},n(h.value?"لغو ویرایش":"ویرایش درخواست"),1)])])):y("",!0),h.value&&((se=C.value)==null?void 0:se.role)!=="customer"?(a(),l("div",vs,[t[47]||(t[47]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"ثبت اقدام",-1)),e("form",{onSubmit:O(pe,["prevent"]),class:"space-y-4"},[e("div",null,[t[35]||(t[35]=e("label",{class:"label"},"نام مشتری",-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value.customerName=s),type:"text",class:"input",disabled:""},null,512),[[E,u.value.customerName]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"label"},"شماره تماس",-1)),w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>u.value.customerPhone=s),type:"tel",class:"input"},null,512),[[E,u.value.customerPhone]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"label"},"نام کاربر",-1)),w(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>u.value.userName=s),type:"text",class:"input",disabled:""},null,512),[[E,u.value.userName]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"label"},"سیستم",-1)),w(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>u.value.system=s),class:"input",disabled:""},[t[38]||(t[38]=e("option",{value:""},"انتخاب کنید",-1)),(a(!0),l(q,null,B(oe(je),s=>(a(),l("option",{key:s,value:s},n(s),9,ps))),128))],512),[[A,u.value.system]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"label"},"نوع درخواست",-1)),w(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>u.value.requestType=s),class:"input",required:""},[t[40]||(t[40]=e("option",{value:""},"انتخاب کنید",-1)),(a(!0),l(q,null,B(oe(Se),s=>(a(),l("option",{key:s,value:s},n(s),9,gs))),128))],512),[[A,u.value.requestType]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"label"},"اولویت",-1)),w(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>u.value.priority=s),class:"input"},[...t[42]||(t[42]=[e("option",{value:"کم"},"کم",-1),e("option",{value:"متوسط"},"متوسط",-1),e("option",{value:"زیاد"},"زیاد",-1),e("option",{value:"فوری"},"فوری",-1)])],512),[[A,u.value.priority]])]),e("div",null,[t[44]||(t[44]=e("label",{class:"label"},"درخواست",-1)),w(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>u.value.request=s),class:"input",rows:"4",required:""},null,512),[[E,u.value.request]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"label"},"شرح اقدام",-1)),w(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=s=>u.value.actionDescription=s),class:"input",rows:"4"},null,512),[[E,u.value.actionDescription]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"label"},"شرح بستن",-1)),w(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>u.value.closeDescription=s),class:"input",rows:"3"},null,512),[[E,u.value.closeDescription]])]),e("div",ms,[e("button",{type:"submit",class:"btn btn-primary flex-1",disabled:d.value},"ذخیره",8,ys),e("button",{type:"button",onClick:Q,class:"btn btn-secondary flex-1"},"انصراف")])],32)])):y("",!0),e("div",xs,[t[50]||(t[50]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"اطلاعات",-1)),e("div",bs,[e("div",null,[t[48]||(t[48]=e("label",{class:"text-gray-600"},"ایجاد کننده:",-1)),e("p",fs,n((le=o.value.createdBy)==null?void 0:le.name),1)]),e("div",null,[t[49]||(t[49]=e("label",{class:"text-gray-600"},"آخرین ویرایش:",-1)),e("p",hs,n($(o.value.updatedAt)),1),e("p",ws,n(de(o.value.updatedAt)),1)])])]),e("div",ks,[e("div",_s,[t[51]||(t[51]=e("h3",{class:"text-lg font-bold text-gray-900"},"تاریخچه تغییرات",-1)),e("button",{onClick:ge,class:"text-blue-600 hover:text-blue-900 text-sm"},n(g.value?"مخفی":"نمایش"),1)]),g.value?(a(),l("div",qs,[f.value?(a(),l("div",Bs,[...t[52]||(t[52]=[e("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"},null,-1)])])):P.value.length===0?(a(),l("div",Ds," تغییراتی ثبت نشده است ")):(a(),l("div",Cs,[(a(!0),l(q,null,B(P.value,(s,U)=>{var Y;return a(),l("div",{key:U,class:"border-b border-gray-200 pb-3 last:border-0"},[e("div",js,[e("span",Ss,n((Y=s.modifiedBy)==null?void 0:Y.name),1),e("span",Ts,n($(s.timestamp)),1)]),e("div",$s,[(a(!0),l(q,null,B(s.changedFields,(z,fe)=>(a(),l("div",{key:fe},[e("span",Es,n(z.field)+":",1),e("span",Ms,n(z.oldValue||"-"),1),t[53]||(t[53]=e("span",{class:"text-green-600 mr-2"},"→",-1)),e("span",Us,n(z.newValue||"-"),1)]))),128))])])}),128))]))])):y("",!0)])])])])):(a(),l("div",Rs,[...t[54]||(t[54]=[e("p",{class:"text-gray-500"},"درخواست یافت نشد",-1)])])),L(Ge,{"is-open":G.value,"onUpdate:isOpen":t[12]||(t[12]=s=>G.value=s),"image-url":ne.value},null,8,["is-open","image-url"])])}}};export{Os as default};
