import{B as m,J as L,k as A,c as n,a as t,j as _,d as P,t as a,e as E,E as H,f as x,v as J,K as y,F as i,p as d,H as g,m as w,i as O,o as r,h as k,q as T}from"./index-B1RxePN7.js";import{a as q,b as z,P as K}from"./constants-CFvVWKro.js";import{u as G}from"./requests-LaLDb1DC.js";import{_ as Q,a as W}from"./EmptyState-8_rENw_2.js";import{d as C}from"./dateUtils-KBV2qcdl.js";const X={class:"space-y-12"},Z={class:"card card-glass relative overflow-hidden p-6 lg:p-8"},tt={class:"relative flex flex-col gap-6 md:flex-row md:items-center md:justify-between"},et={class:"space-y-3"},st={class:"flex flex-wrap gap-3 text-xs text-smoke-500"},lt={class:"pill"},ot={key:0,class:"pill"},at={class:"card card-muted"},rt={class:"mt-6 grid grid-cols-1 gap-4 md:grid-cols-2"},nt=["value"],it=["value"],dt=["value"],ut={key:0,class:"flex flex-wrap items-center gap-2 rounded-3xl border border-white/40 bg-white/70 p-3 shadow-soft backdrop-blur-xl"},pt=["onClick"],mt={class:"space-y-4"},xt={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},ct={class:"text-sm text-smoke-500"},ft={key:2,class:"table-container"},bt={class:"table"},yt={class:"px-6 py-4 align-top"},gt={class:"text-sm font-semibold text-smoke-800"},kt={class:"mt-1 text-xs text-smoke-500"},vt={class:"px-6 py-4 align-top"},ht={class:"text-sm font-semibold text-smoke-700"},_t={class:"mt-1 text-xs text-smoke-500"},wt={class:"px-6 py-4 align-top"},Tt={class:"px-6 py-4 align-top"},Ct={class:"px-6 py-4 align-top text-sm text-smoke-600"},St={class:"px-6 py-4 align-top text-sm text-smoke-600"},Ft={class:"text-xs text-smoke-400"},Rt={class:"px-6 py-4 align-top"},Nt=["onClick"],Ut={__name:"Requests",setup(jt){const S=O(),c=G(),F=m(()=>c.loading),f=m(()=>c.requests),R=new Intl.NumberFormat("fa-IR",{maximumFractionDigits:0}),s=L({fullText:"",status:"",system:"",priority:""}),u=m(()=>{const o=[];return s.fullText&&o.push({key:"fullText",label:`جستجو: ${s.fullText}`}),s.status&&o.push({key:"status",label:`وضعیت: ${s.status}`}),s.system&&o.push({key:"system",label:`سیستم: ${s.system}`}),s.priority&&o.push({key:"priority",label:`اولویت: ${s.priority}`}),o}),v=m(()=>f.value.length),h=o=>{const e=Number(o??0);return Number.isFinite(e)?R.format(e):"۰"},N=()=>({fullText:s.fullText||"",status:s.status||"",system:s.system||"",priority:s.priority||""}),j=()=>{const o={};return s.fullText&&(o.fullText=s.fullText),s.status&&(o.status=s.status),s.system&&(o.system=s.system),s.priority&&(o.priority=s.priority),o},B=async o=>{o==="fullText"&&(s.fullText=""),o==="status"&&(s.status=""),o==="system"&&(s.system=""),o==="priority"&&(s.priority=""),await p()},I=async()=>{s.fullText="",s.status="",s.system="",s.priority="",await p()},p=async()=>{const o=j();await c.fetchRequests(o),localStorage.setItem("requestsFilters",JSON.stringify(N()))},M=o=>{S.push({name:"RequestDetails",params:{id:o}})},D=o=>o?C.formatDate(o,"jYYYY/jMM/jDD HH:mm"):"—",V=o=>o?C.getRelativeTime(o):"",$=o=>{switch(o){case"باز":return"badge-warning";case"انجام":return"badge-success";case"در درست اقدام":return"badge-info";default:return"badge-secondary"}},U=o=>{switch(o){case"فوری":return"badge-danger";case"زیاد":return"badge-warning";case"متوسط":return"badge-info";case"کم":return"badge-secondary";default:return"badge-secondary"}};return A(async()=>{const o=localStorage.getItem("requestsFilters");if(o)try{const e=JSON.parse(o);s.fullText=e.fullText||"",s.status=e.status||"",s.system=e.system||"",s.priority=e.priority||""}catch{s.fullText="",s.status="",s.system="",s.priority=""}await p()}),(o,e)=>{const Y=H("router-link");return r(),n("div",X,[t("section",Z,[e[8]||(e[8]=t("span",{class:"pointer-events-none absolute inset-x-1/2 -top-24 h-64 w-64 -translate-x-1/2 rounded-full bg-gradient-to-br from-brand-400/25 via-iris-400/20 to-teal-400/25 blur-3xl"},null,-1)),t("div",tt,[t("div",et,[e[4]||(e[4]=t("span",{class:"pill"},"جستجوی درخواست‌ها",-1)),e[5]||(e[5]=t("h1",{class:"text-3xl font-black text-smoke-900 md:text-4xl"}," لیست درخواست‌ها ",-1)),e[6]||(e[6]=t("p",{class:"max-w-2xl text-sm text-smoke-500 md:text-base"}," با ترکیب جستجوی متن کامل و فیلترهای ساختاری، دقیق‌ترین نتایج را برای مشتریان و متخصصان پیدا کنید. ",-1)),t("div",st,[t("span",lt,"تعداد نتایج: "+a(h(v.value)),1),u.value.length?(r(),n("span",ot," فیلترهای فعال: "+a(u.value.length),1)):_("",!0)])]),P(Y,{to:"/requests/create",class:"btn btn-primary"},{default:E(()=>[...e[7]||(e[7]=[k(" ثبت درخواست جدید ",-1)])]),_:1})])]),t("section",at,[t("header",{class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},[e[9]||(e[9]=t("div",null,[t("h2",{class:"text-lg font-extrabold text-smoke-900 md:text-xl"},"فیلترهای پیشرفته"),t("p",{class:"text-sm text-smoke-500"},"جستجوی دقیق بر اساس وضعیت، سیستم، اولویت و متن")],-1)),t("div",{class:"flex flex-wrap items-center gap-2 sm:gap-3"},[t("button",{class:"btn btn-secondary",onClick:I},"بازنشانی فیلترها"),t("button",{class:"btn btn-primary",onClick:p},"اعمال فیلتر")])]),t("div",rt,[t("div",null,[e[10]||(e[10]=t("label",{class:"label"},"متن کامل",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.fullText=l),type:"text",class:"input",placeholder:"عبارتی برای جستجو در عنوان، شرح یا نظرات"},null,512),[[J,s.fullText]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"label"},"وضعیت",-1)),x(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.status=l),class:"input"},[e[11]||(e[11]=t("option",{value:""},"همه",-1)),(r(!0),n(i,null,d(g(q),l=>(r(),n("option",{key:l,value:l},a(l),9,nt))),128))],512),[[y,s.status]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"label"},"سیستم",-1)),x(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.system=l),class:"input"},[e[13]||(e[13]=t("option",{value:""},"همه",-1)),(r(!0),n(i,null,d(g(z),l=>(r(),n("option",{key:l,value:l},a(l),9,it))),128))],512),[[y,s.system]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"label"},"اولویت",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.priority=l),class:"input"},[e[15]||(e[15]=t("option",{value:""},"همه",-1)),(r(!0),n(i,null,d(g(K),l=>(r(),n("option",{key:l,value:l},a(l),9,dt))),128))],512),[[y,s.priority]])])])]),u.value.length?(r(),n("div",ut,[e[18]||(e[18]=t("span",{class:"text-xs font-semibold text-smoke-500"},"فیلترهای فعال:",-1)),(r(!0),n(i,null,d(u.value,l=>(r(),n("span",{key:l.key,class:"inline-flex items-center gap-2 rounded-full border border-brand-200/70 bg-brand-50/70 px-3 py-1 text-xs font-semibold text-brand-600"},[k(a(l.label)+" ",1),t("button",{class:"flex h-5 w-5 items-center justify-center rounded-full border border-transparent text-brand-500 transition hover:border-brand-200/80 hover:bg-white/70 hover:text-brand-700",onClick:b=>B(l.key),"aria-label":"حذف فیلتر",type:"button"},[...e[17]||(e[17]=[t("svg",{class:"h-3.5 w-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,pt)]))),128))])):_("",!0),t("section",mt,[t("header",xt,[t("div",null,[e[19]||(e[19]=t("h2",{class:"text-xl font-extrabold text-smoke-900 md:text-2xl"},"نتایج درخواست‌ها",-1)),t("p",ct,"نمایش "+a(h(v.value))+" درخواست بر اساس فیلترهای فعال",1)])]),F.value?(r(),w(Q,{key:0,lines:6,tone:"brand"})):f.value.length?(r(),n("div",ft,[t("table",bt,[e[21]||(e[21]=t("thead",null,[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," درخواست "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," مشتری / سیستم "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," وضعیت "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," اولویت "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," متخصص "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," تاریخ "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-[0.35em] text-smoke-400"}," عملیات ")])],-1)),t("tbody",null,[(r(!0),n(i,null,d(f.value,l=>{var b;return r(),n("tr",{key:l._id,class:"transition-colors duration-200 hover:bg-brand-50/40"},[t("td",yt,[t("p",gt,a(l.request),1),t("p",kt,a(l.requestType||"—"),1)]),t("td",vt,[t("p",ht,a(l.customerName||"—"),1),t("p",_t,a(l.system||"—"),1)]),t("td",wt,[t("span",{class:T(["badge",$(l.status)])},a(l.status||"نامشخص"),3)]),t("td",Tt,[t("span",{class:T(["badge",U(l.priority)])},a(l.priority||"—"),3)]),t("td",Ct,a(((b=l.assignedTo)==null?void 0:b.name)||"اختصاص داده نشده"),1),t("td",St,[t("div",null,a(D(l.createdAt||l.date)),1),t("div",Ft,a(V(l.createdAt||l.date)),1)]),t("td",Rt,[t("button",{class:"inline-flex items-center gap-2 rounded-xl border border-brand-200/70 px-3 py-1.5 text-xs font-semibold text-brand-600 transition-all duration-200 hover:bg-brand-50/60",onClick:Bt=>M(l._id)},[...e[20]||(e[20]=[k(" مشاهده ",-1),t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.6",d:"M9 5l7 7-7 7"})],-1)])],8,Nt)])])}),128))])])])):(r(),w(W,{key:1,title:"درخواستی یافت نشد",description:"فیلترها را بازنشانی کنید یا جستجوی دیگری انجام دهید."}))])])}}};export{Ut as default};
