import{B as O,J as j,r as N,c as l,a as t,j as h,f as d,v as u,n as F,K as V,F as g,p as b,H as x,t as p,w as A,h as L,E as I,o as a,b as R,q,d as z,e as H,O as J}from"./index-B1RxePN7.js";import{u as G}from"./customers-DVU7Vi3h.js";import{u as Q}from"./specialists-BivIS57Z.js";import{g as B,C as T}from"./constants-CFvVWKro.js";import{S as W}from"./sweetalert2.esm.all-ePrzfkxH.js";const X={class:"space-y-6"},Y={class:"flex flex-col gap-4 rounded-2xl border border-gray-100 bg-white/80 p-4 shadow-sm md:flex-row md:items-center md:justify-between md:p-6"},Z={class:"flex flex-wrap items-center gap-2 sm:gap-3 md:justify-end"},tt=["disabled"],st={class:"rounded-2xl border border-gray-100 bg-white/80 p-5 shadow-sm"},et={class:"grid grid-cols-1 gap-4 md:grid-cols-4 md:items-end"},lt={class:"flex flex-col gap-2"},at={class:"flex flex-col gap-2"},ot=["value"],nt={class:"flex flex-col gap-2"},it=["value"],dt={class:"flex flex-col gap-2"},rt={class:"mt-4 flex justify-end"},pt=["disabled"],ut={class:"rounded-2xl border border-gray-100 bg-white/80 shadow-sm"},ct={key:0,class:"space-y-3 p-6"},xt={key:1,class:"overflow-x-auto rounded-2xl"},mt={class:"min-w-full divide-y divide-gray-100 text-sm"},gt={class:"divide-y divide-gray-100 bg-white"},bt={class:"px-6 py-4"},yt={class:"flex flex-col gap-1"},vt={class:"text-sm font-semibold text-gray-900"},ft={key:0,class:"text-xs text-gray-500"},_t={class:"px-6 py-4 text-sm text-gray-700"},ht={class:"px-6 py-4"},wt={class:"badge badge-info"},Ct={class:"px-6 py-4"},kt={class:"px-6 py-4"},St={class:"flex flex-wrap gap-2"},Vt={key:0,class:"text-xs text-gray-400"},Ut={class:"px-6 py-4"},jt={class:"flex flex-wrap items-center gap-3"},Nt=["onClick"],Bt=["onClick"],Tt={key:0},Mt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4"},Et={class:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-xl"},Ot={class:"flex items-center justify-between border-b border-gray-100 pb-4"},Ft={class:"text-2xl font-bold text-gray-900"},Lt={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Pt={class:"md:col-span-2"},$t=["value"],Dt=["value"],Kt={class:"md:col-span-2"},At={class:"md:col-span-2"},It={class:"md:col-span-2 space-y-3"},Rt={class:"flex items-center justify-between"},qt={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},zt=["value"],Ht={class:"text-sm font-semibold text-gray-900"},Jt={class:"text-xs text-gray-500"},Gt={key:0,class:"text-xs text-gray-400"},Qt={class:"space-y-4 rounded-xl border border-gray-100 bg-gray-50/60 p-4"},Wt={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Xt={class:"md:col-span-3"},Yt={class:"flex justify-end gap-3 border-t border-gray-100 pt-4"},Zt=["disabled"],ns={__name:"CustomerDirectory",setup(ts){const m=G(),y=Q(),w=O(()=>m.loading),M=O(()=>m.items),c=j({...m.filters}),C=N(!1),f=N(null),n=j({name:"",companyName:"",code:"",status:"active",tier:"standard",tags:[],notes:"",assignedSpecialists:[],contacts:[]}),r=j({name:"",email:"",phone:"",position:"",isPrimary:!0}),v=N(""),_=async()=>{m.setFilters(c),await m.fetchCustomers()},E=()=>{f.value=null,Object.assign(n,{name:"",companyName:"",code:"",status:"active",tier:"standard",tags:[],notes:"",assignedSpecialists:[],contacts:[]}),Object.assign(r,{name:"",email:"",phone:"",position:"",isPrimary:!0}),v.value=""},P=async()=>{E(),C.value=!0,y.items.length||await y.fetchSpecialists()},U=()=>{C.value=!1,E()},$=async()=>{const o={...n,tags:v.value?v.value.split(",").map(s=>s.trim()).filter(Boolean):[],contacts:[]};(r.name||r.email||r.phone)&&o.contacts.push({...r});try{f.value?await m.updateCustomer(f.value._id,o):await m.createCustomer(o),U()}catch{}},D=async o=>{var k;f.value=o,Object.assign(n,{name:o.name,companyName:o.companyName,code:o.code,status:o.status,tier:o.tier,tags:o.tags||[],notes:o.notes||"",assignedSpecialists:(o.assignedSpecialists||[]).map(e=>e._id),contacts:o.contacts||[]}),v.value=(o.tags||[]).join(", ");const s=((k=o.contacts)==null?void 0:k.find(e=>e.isPrimary))||{};Object.assign(r,{name:s.name||"",email:s.email||"",phone:s.phone||"",position:s.position||"",isPrimary:!0}),C.value=!0,y.items.length||await y.fetchSpecialists()},K=async o=>{(await W.fire({title:`غیرفعال کردن ${o.name}`,text:"آیا از غیرفعال کردن این مشتری اطمینان دارید؟",icon:"warning",showCancelButton:!0,confirmButtonText:"بله، غیرفعال کن",cancelButtonText:"انصراف",reverseButtons:!0})).isConfirmed&&await m.archiveCustomer(o._id)};return _(),(o,s)=>{const k=I("router-link");return a(),l("div",X,[t("section",Y,[s[17]||(s[17]=t("div",null,[t("p",{class:"text-xs font-semibold uppercase tracking-widest text-primary-500"}," مدیریت مشتریان "),t("h1",{class:"mt-2 text-2xl font-extrabold text-gray-900 md:text-3xl"}," فهرست مشتریان "),t("p",{class:"mt-1 text-sm text-gray-600 md:text-base"}," مدیریت اطلاعات مشتریان، مخاطبین و سطح خدمات در یک نگاه ")],-1)),t("div",Z,[t("button",{class:"btn btn-secondary",onClick:_,disabled:w.value}," بروزرسانی ",8,tt),t("button",{class:"btn btn-primary",onClick:P}," مشتری جدید ")])]),t("section",st,[t("div",et,[t("div",lt,[s[18]||(s[18]=t("label",{class:"label text-xs font-semibold text-gray-700"},"جستجو",-1)),d(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>c.search=e),type:"text",class:"input",placeholder:"نام مشتری یا شرکت",onKeyup:F(_,["enter"])},null,544),[[u,c.search]])]),t("div",at,[s[20]||(s[20]=t("label",{class:"label text-xs font-semibold text-gray-700"},"وضعیت",-1)),d(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>c.status=e),class:"input"},[s[19]||(s[19]=t("option",{value:""},"همه",-1)),(a(!0),l(g,null,b(x(B),(e,i)=>(a(),l("option",{key:i,value:i},p(e),9,ot))),128))],512),[[V,c.status]])]),t("div",nt,[s[22]||(s[22]=t("label",{class:"label text-xs font-semibold text-gray-700"},"سطح",-1)),d(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>c.tier=e),class:"input"},[s[21]||(s[21]=t("option",{value:""},"همه",-1)),(a(!0),l(g,null,b(x(T),(e,i)=>(a(),l("option",{key:i,value:i},p(e),9,it))),128))],512),[[V,c.tier]])]),t("div",dt,[s[23]||(s[23]=t("label",{class:"label text-xs font-semibold text-gray-700"},"برچسب",-1)),d(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>c.tag=e),type:"text",class:"input",placeholder:"مثال: VIP",onKeyup:F(_,["enter"])},null,544),[[u,c.tag]])])]),t("div",rt,[t("button",{class:"btn btn-light",onClick:_,disabled:w.value}," اعمال فیلتر ",8,pt)])]),t("section",ut,[w.value?(a(),l("div",ct,[(a(),l(g,null,b(6,e=>t("div",{key:`customer-skeleton-${e}`,class:"animate-pulse space-y-3 rounded-xl border border-gray-100 bg-gray-50/60 p-4"},[...s[24]||(s[24]=[R('<div class="flex items-center justify-between"><div class="h-4 w-1/4 rounded bg-gray-200"></div><div class="h-3 w-16 rounded bg-gray-200"></div></div><div class="h-3 w-1/2 rounded bg-gray-200"></div><div class="flex flex-wrap gap-2"><div class="h-6 w-20 rounded-full bg-gray-200"></div><div class="h-6 w-20 rounded-full bg-gray-200"></div><div class="h-6 w-24 rounded-full bg-gray-200"></div></div>',3)])])),64))])):(a(),l("div",xt,[t("table",mt,[s[27]||(s[27]=t("thead",{class:"bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-500"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right"},"مشتری"),t("th",{class:"px-6 py-3 text-right"},"شرکت"),t("th",{class:"px-6 py-3 text-right"},"سطح"),t("th",{class:"px-6 py-3 text-right"},"وضعیت"),t("th",{class:"px-6 py-3 text-right"},"متخصصین"),t("th",{class:"px-6 py-3 text-right"},"عملیات")])],-1)),t("tbody",gt,[(a(!0),l(g,null,b(M.value,e=>{var i;return a(),l("tr",{key:e._id,class:"transition hover:bg-gray-50"},[t("td",bt,[t("div",yt,[t("span",vt,p(e.name),1),e.code?(a(),l("span",ft,"کد: "+p(e.code),1)):h("",!0)])]),t("td",_t,p(e.companyName||"—"),1),t("td",ht,[t("span",wt,p(x(T)[e.tier]||"استاندارد"),1)]),t("td",Ct,[t("span",{class:q(["badge",e.status==="active"?"badge-success":e.status==="prospect"?"badge-warning":"badge-secondary"])},p(x(B)[e.status]||"نامشخص"),3)]),t("td",kt,[t("div",St,[(a(!0),l(g,null,b(e.assignedSpecialists||[],S=>(a(),l("span",{key:S._id,class:"badge badge-outline"},p(S.name),1))),128)),(i=e.assignedSpecialists)!=null&&i.length?h("",!0):(a(),l("span",Vt," اختصاص داده نشده "))])]),t("td",Ut,[t("div",jt,[z(k,{to:{name:"CustomerDetails",params:{id:e._id}},class:"text-primary-600 hover:text-primary-700"},{default:H(()=>[...s[25]||(s[25]=[L(" جزئیات ",-1)])]),_:1},8,["to"]),t("button",{class:"text-indigo-600 hover:text-indigo-700",onClick:S=>D(e)}," ویرایش ",8,Nt),t("button",{class:"text-red-600 hover:text-red-700",onClick:S=>K(e)}," غیرفعال ",8,Bt)])])])}),128)),M.value.length?h("",!0):(a(),l("tr",Tt,[...s[26]||(s[26]=[t("td",{colspan:"6",class:"px-6 py-12 text-center text-sm text-gray-500"}," مشتری یافت نشد. با استفاده از دکمه «مشتری جدید» اولین مشتری خود را اضافه کنید. ",-1)])]))])])]))]),C.value?(a(),l("div",Mt,[t("div",Et,[t("div",Ot,[t("div",null,[t("h2",Ft,p(f.value?"ویرایش مشتری":"مشتری جدید"),1),s[28]||(s[28]=t("p",{class:"text-sm text-gray-500"},"اطلاعات مشتری و مخاطب اصلی را تکمیل کنید.",-1))]),t("button",{class:"text-gray-400 transition hover:text-gray-600",onClick:U,"aria-label":"بستن"}," ✕ ")]),t("form",{onSubmit:A($,["prevent"]),class:"mt-6 space-y-6 overflow-y-auto max-h-[70vh] pr-1"},[t("div",Lt,[t("div",Pt,[s[29]||(s[29]=t("label",{class:"label"},[L("نام مشتری "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>n.name=e),type:"text",class:"input",required:""},null,512),[[u,n.name]])]),t("div",null,[s[30]||(s[30]=t("label",{class:"label"},"نام سازمان",-1)),d(t("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>n.companyName=e),type:"text",class:"input"},null,512),[[u,n.companyName]])]),t("div",null,[s[31]||(s[31]=t("label",{class:"label"},"کد مشتری",-1)),d(t("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>n.code=e),type:"text",class:"input"},null,512),[[u,n.code]])]),t("div",null,[s[32]||(s[32]=t("label",{class:"label"},"وضعیت",-1)),d(t("select",{"onUpdate:modelValue":s[7]||(s[7]=e=>n.status=e),class:"input"},[(a(!0),l(g,null,b(x(B),(e,i)=>(a(),l("option",{key:i,value:i},p(e),9,$t))),128))],512),[[V,n.status]])]),t("div",null,[s[33]||(s[33]=t("label",{class:"label"},"سطح",-1)),d(t("select",{"onUpdate:modelValue":s[8]||(s[8]=e=>n.tier=e),class:"input"},[(a(!0),l(g,null,b(x(T),(e,i)=>(a(),l("option",{key:i,value:i},p(e),9,Dt))),128))],512),[[V,n.tier]])]),t("div",Kt,[s[34]||(s[34]=t("label",{class:"label"},"برچسب‌ها",-1)),d(t("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>v.value=e),type:"text",class:"input",placeholder:"هر برچسب را با کاما جدا کنید"},null,512),[[u,v.value]])]),t("div",At,[s[35]||(s[35]=t("label",{class:"label"},"یادداشت",-1)),d(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=e=>n.notes=e),class:"input h-24"},null,512),[[u,n.notes]])]),t("div",It,[t("div",Rt,[s[36]||(s[36]=t("label",{class:"label m-0"},"متخصصین اختصاص داده شده",-1)),t("button",{type:"button",class:"text-xs text-indigo-600 hover:text-indigo-700",onClick:s[11]||(s[11]=e=>x(y).fetchSpecialists())}," بروزرسانی لیست ")]),t("div",qt,[(a(!0),l(g,null,b(x(y).items,e=>(a(),l("label",{key:e._id,class:"flex items-center gap-2 rounded-lg border border-gray-200 p-3"},[d(t("input",{type:"checkbox",value:e._id,"onUpdate:modelValue":s[12]||(s[12]=i=>n.assignedSpecialists=i)},null,8,zt),[[J,n.assignedSpecialists]]),t("div",null,[t("p",Ht,p(e.name),1),t("p",Jt,p(e.jobTitle||"متخصص"),1)])]))),128)),x(y).items.length?h("",!0):(a(),l("p",Gt," متخصصی ثبت نشده است. ابتدا متخصص جدید ایجاد کنید. "))])])]),t("div",Qt,[s[41]||(s[41]=t("h3",{class:"text-sm font-semibold text-gray-900"},"مخاطب اصلی",-1)),t("div",Wt,[t("div",null,[s[37]||(s[37]=t("label",{class:"label"},"نام",-1)),d(t("input",{"onUpdate:modelValue":s[13]||(s[13]=e=>r.name=e),type:"text",class:"input"},null,512),[[u,r.name]])]),t("div",null,[s[38]||(s[38]=t("label",{class:"label"},"ایمیل",-1)),d(t("input",{"onUpdate:modelValue":s[14]||(s[14]=e=>r.email=e),type:"email",class:"input"},null,512),[[u,r.email]])]),t("div",null,[s[39]||(s[39]=t("label",{class:"label"},"تلفن",-1)),d(t("input",{"onUpdate:modelValue":s[15]||(s[15]=e=>r.phone=e),type:"text",class:"input"},null,512),[[u,r.phone]])]),t("div",Xt,[s[40]||(s[40]=t("label",{class:"label"},"سمت",-1)),d(t("input",{"onUpdate:modelValue":s[16]||(s[16]=e=>r.position=e),type:"text",class:"input"},null,512),[[u,r.position]])])])]),t("div",Yt,[t("button",{type:"button",class:"btn btn-light",onClick:U}," انصراف "),t("button",{type:"submit",class:"btn btn-primary",disabled:w.value}," ذخیره اطلاعات ",8,Zt)])],32)])])):h("",!0)])}}};export{ns as default};
