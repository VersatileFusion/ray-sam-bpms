import{r as f,B as R,J as F,k as H,c as i,a as e,j as g,h as w,F as k,p as S,t as u,w as N,f as n,v as d,K as T,H as x,o,b as $,q as B,O as z}from"./index-B1RxePN7.js";import{u as J}from"./users-D1WZpKAU.js";import{c as h,d as b,e as L,f as K,b as G}from"./constants-CFvVWKro.js";import{d as V}from"./dateUtils-KBV2qcdl.js";import{S as C}from"./sweetalert2.esm.all-ePrzfkxH.js";const Q={class:"card"},W={key:0,class:"space-y-3 p-6"},X={key:1,class:"overflow-x-auto"},Z={class:"min-w-full"},ee={class:"bg-white divide-y divide-gray-200"},te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},le={class:"px-6 py-4 whitespace-nowrap text-sm"},ae={class:"px-6 py-4 whitespace-nowrap text-sm"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},oe={class:"px-6 py-4 whitespace-nowrap text-sm space-x-2 space-x-reverse"},ne=["onClick"],re=["onClick"],de={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},pe={class:"bg-white rounded-lg p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto"},ue={class:"flex items-center justify-between mb-4"},ce={class:"text-2xl font-bold text-gray-900"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve=["disabled"],xe={class:"label"},be={key:0,class:"text-red-500"},ye=["required","placeholder"],fe=["value"],ge={key:0,class:"md:col-span-2"},we=["value"],ke={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4 md:col-span-2"},Se={key:2,class:"md:col-span-2"},Ae={class:"flex flex-wrap gap-2"},Ue=["value"],Te={class:"text-sm text-gray-700"},he={class:"md:col-span-2"},Ce={class:"md:col-span-2"},Pe={class:"flex justify-end space-x-4 space-x-reverse mt-6"},je=["disabled"],Me={__name:"UserManagement",setup(Be){const y=J(),c=f(!1),A=f(!1),p=f(null),E=R(()=>y.users),l=F({name:"",username:"",password:"",role:b.USER,email:"",phone:"",jobTitle:"",department:"",isActive:!0,specialistProfile:{status:h.AVAILABLE,capacity:5,experienceYears:0,systems:[]},skills:[],tags:[]}),m=f(""),v=f(""),I=a=>L[a]||a,_=a=>a?typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a)?V.gregorianToJalali(a):V.formatDate(a,"jYYYY/jMM/jDD HH:mm"):"-",P=()=>{p.value=null,Object.assign(l,{name:"",username:"",password:"",role:b.USER,email:"",phone:"",jobTitle:"",department:"",isActive:!0,specialistProfile:{status:h.AVAILABLE,capacity:5,experienceYears:0,systems:[]},skills:[],tags:[]}),m.value="",v.value=""},M=()=>{P(),A.value=!0},U=()=>{A.value=!1,P()},Y=()=>({name:l.name,username:l.username,password:l.password,role:l.role,email:l.email,phone:l.phone,jobTitle:l.jobTitle,department:l.department,isActive:l.isActive,specialistProfile:l.role===b.SPECIALIST?l.specialistProfile:void 0,skills:m.value?m.value.split(",").map(a=>a.trim()).filter(Boolean):[],tags:v.value?v.value.split(",").map(a=>a.trim()).filter(Boolean):[]}),q=async()=>{c.value=!0;try{const a=Y();p.value?(a.password||delete a.password,await y.updateUser(p.value,a)):await y.createUser(a),U()}catch(a){console.error("Error saving user:",a)}finally{c.value=!1}},D=a=>{var t,s,r,j;p.value=a._id,Object.assign(l,{name:a.name,username:a.username,password:"",role:a.role,email:a.email||"",phone:a.phone||"",jobTitle:a.jobTitle||"",department:a.department||"",isActive:a.isActive!==!1,specialistProfile:{status:((t=a.specialistProfile)==null?void 0:t.status)||h.AVAILABLE,capacity:((s=a.specialistProfile)==null?void 0:s.capacity)??5,experienceYears:((r=a.specialistProfile)==null?void 0:r.experienceYears)??0,systems:[...((j=a.specialistProfile)==null?void 0:j.systems)||[]]},skills:a.skills||[],tags:a.tags||[]}),m.value=(a.skills||[]).join(", "),v.value=(a.tags||[]).join(", "),A.value=!0},O=async a=>{if((await C.fire({title:"آیا از حذف این کاربر اطمینان دارید؟",text:"این عملیات قابل برگشت نیست.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، حذف کن",cancelButtonText:"لغو",reverseButtons:!0})).isConfirmed)try{await y.deleteUser(a),await C.fire({icon:"success",title:"موفقیت‌آمیز!",text:"کاربر با موفقیت حذف شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(s){console.error("Error deleting user:",s),await C.fire({icon:"error",title:"خطا!",text:"خطا در حذف کاربر",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}};return H(async()=>{c.value=!0;try{await y.fetchUsers()}finally{c.value=!1}}),(a,t)=>(o(),i("div",null,[e("div",{class:"mb-6 flex justify-between items-center"},[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"مدیریت کاربران"),e("p",{class:"text-gray-600 mt-2"},"مدیریت و ویرایش کاربران سیستم")],-1)),e("button",{onClick:M,class:"btn btn-primary"},[...t[15]||(t[15]=[e("svg",{class:"w-5 h-5 inline ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),w(" کاربر جدید ",-1)])])]),e("div",Q,[c.value?(o(),i("div",W,[(o(),i(k,null,S(6,s=>e("div",{key:`user-skeleton-${s}`,class:"animate-pulse space-y-3 rounded-xl border border-gray-100 bg-gray-50/60 p-4"},[...t[17]||(t[17]=[$('<div class="flex items-center justify-between"><div class="h-4 w-1/4 rounded bg-gray-200"></div><div class="h-4 w-10 rounded-full bg-gray-200"></div></div><div class="h-3 w-1/5 rounded bg-gray-200"></div><div class="flex flex-wrap gap-2"><div class="h-6 w-20 rounded-full bg-gray-200"></div><div class="h-6 w-16 rounded-full bg-gray-200"></div></div>',3)])])),64))])):(o(),i("div",X,[e("table",Z,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نام"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نام کاربری"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نقش"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"وضعیت"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"آخرین ورود"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"عملیات")])],-1)),e("tbody",ee,[(o(!0),i(k,null,S(E.value,s=>(o(),i("tr",{key:s._id,class:"hover:bg-gray-50"},[e("td",te,u(s.name),1),e("td",se,u(s.username),1),e("td",le,[e("span",{class:B(["badge",s.role==="admin"?"badge-warning":"badge-info"])},u(I(s.role)),3)]),e("td",ae,[e("span",{class:B(s.isActive?"badge badge-success":"badge badge-danger")},u(s.isActive?"فعال":"غیرفعال"),3)]),e("td",ie,u(_(s.lastLogin)),1),e("td",oe,[e("button",{onClick:r=>D(s),class:"text-blue-600 hover:text-blue-900"}," ویرایش ",8,ne),e("button",{onClick:r=>O(s._id),class:"text-red-600 hover:text-red-900"}," حذف ",8,re)])]))),128))])])]))]),A.value?(o(),i("div",de,[e("div",pe,[e("div",ue,[e("h2",ce,u(p.value?"ویرایش کاربر":"کاربر جدید"),1),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:U},"✕")]),e("form",{onSubmit:N(q,["prevent"])},[e("div",me,[e("div",null,[t[19]||(t[19]=e("label",{class:"label"},[w("نام "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.name=s),type:"text",class:"input",required:""},null,512),[[d,l.name]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"label"},[w("نام کاربری "),e("span",{class:"text-red-500"},"*")],-1)),n(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.username=s),type:"text",class:"input",disabled:!!p.value,required:""},null,8,ve),[[d,l.username]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"label"},"ایمیل",-1)),n(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.email=s),type:"email",class:"input"},null,512),[[d,l.email]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"label"},"شماره تماس",-1)),n(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.phone=s),type:"text",class:"input"},null,512),[[d,l.phone]])]),e("div",null,[e("label",xe,[t[23]||(t[23]=w("رمز عبور",-1)),p.value?g("",!0):(o(),i("span",be,"*"))]),n(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.password=s),required:!p.value,type:"password",class:"input",placeholder:p.value?"در صورت نیاز به تغییر رمز":""},null,8,ye),[[d,l.password]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"label"},[w("نقش "),e("span",{class:"text-red-500"},"*")],-1)),n(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.role=s),class:"input",required:""},[(o(!0),i(k,null,S(x(L),(s,r)=>(o(),i("option",{key:r,value:r},u(s),9,fe))),128))],512),[[T,l.role]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"label"},"سمت",-1)),n(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.jobTitle=s),type:"text",class:"input"},null,512),[[d,l.jobTitle]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"label"},"دپارتمان",-1)),n(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.department=s),type:"text",class:"input"},null,512),[[d,l.department]])]),l.role===x(b).SPECIALIST?(o(),i("div",ge,[t[27]||(t[27]=e("label",{class:"label"},"وضعیت متخصص",-1)),n(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.specialistProfile.status=s),class:"input"},[(o(!0),i(k,null,S(x(K),(s,r)=>(o(),i("option",{key:r,value:r},u(s),9,we))),128))],512),[[T,l.specialistProfile.status]])])):g("",!0),l.role===x(b).SPECIALIST?(o(),i("div",ke,[e("div",null,[t[28]||(t[28]=e("label",{class:"label"},"ظرفیت",-1)),n(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>l.specialistProfile.capacity=s),type:"number",min:"0",class:"input"},null,512),[[d,l.specialistProfile.capacity,void 0,{number:!0}]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"label"},"تجربه (سال)",-1)),n(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>l.specialistProfile.experienceYears=s),type:"number",min:"0",class:"input"},null,512),[[d,l.specialistProfile.experienceYears,void 0,{number:!0}]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"label"},"وضعیت فعالیت",-1)),n(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>l.isActive=s),class:"input"},[...t[30]||(t[30]=[e("option",{value:!0},"فعال",-1),e("option",{value:!1},"غیرفعال",-1)])],512),[[T,l.isActive]])])])):g("",!0),l.role===x(b).SPECIALIST?(o(),i("div",Se,[t[32]||(t[32]=e("label",{class:"label"},"سیستم‌های تخصصی",-1)),e("div",Ae,[(o(!0),i(k,null,S(x(G),s=>(o(),i("label",{key:s,class:"flex items-center gap-2 px-3 py-2 border rounded-md"},[n(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[12]||(t[12]=r=>l.specialistProfile.systems=r)},null,8,Ue),[[z,l.specialistProfile.systems]]),e("span",Te,u(s),1)]))),128))])])):g("",!0),e("div",he,[t[33]||(t[33]=e("label",{class:"label"},"مهارت‌ها",-1)),n(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>m.value=s),type:"text",class:"input",placeholder:"هر مهارت را با کاما جدا کنید"},null,512),[[d,m.value]])]),e("div",Ce,[t[34]||(t[34]=e("label",{class:"label"},"برچسب‌ها",-1)),n(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>v.value=s),type:"text",class:"input",placeholder:"مثال: ارشد، تمام‌وقت"},null,512),[[d,v.value]])])]),e("div",Pe,[e("button",{type:"button",onClick:U,class:"btn btn-secondary"}," انصراف "),e("button",{type:"submit",class:"btn btn-primary",disabled:c.value},u(p.value?"ذخیره تغییرات":"ایجاد کاربر"),9,je)])],32)])])):g("",!0)]))}};export{Me as default};
