import{u as M,r as w,A as c,k as z,c as n,a as e,b as u,d as k,f as d,I as p,F as V,p as B,C as A,h as H,t as m,o as i}from"./index-NaxcUE6C.js";import{u as N}from"./users-BxaSixr-.js";import{r as x}from"./reportService-BCSXA11K.js";import{a as P}from"./constants-CjjkXsVG.js";import{d as C}from"./dateUtils-B4onfrge.js";import{P as T}from"./PersianDatePicker-DxPeU3f5.js";import{S as a}from"./sweetalert2.esm.all-ePrzfkxH.js";const R={class:"card mb-6"},F={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},G=["value"],I=["value"],L={class:"text-center"},q=["disabled"],Y={key:0,class:"mr-2"},J={key:1,class:"mr-2"},tt={__name:"Reports",setup(K){const D=M(),f=N(),r=w(!1),s=w({startDate:"",endDate:"",status:"",system:"",priority:"",assignedTo:""}),S=c(()=>D.user),E=c(()=>f.users),h=c(()=>E.value.filter(o=>o.role==="admin"||o.role==="user")),v=()=>{const o={};return s.value.startDate&&(o.startDate=C.jalaliToGregorian(s.value.startDate)),s.value.endDate&&(o.endDate=C.jalaliToGregorian(s.value.endDate)),s.value.status&&(o.status=s.value.status),s.value.system&&(o.system=s.value.system),s.value.priority&&(o.priority=s.value.priority),s.value.assignedTo&&(o.assignedTo=s.value.assignedTo),o},U=async()=>{const o=await a.fire({title:"انتخاب نوع گزارش",text:"لطفا نوع گزارش مورد نظر را انتخاب کنید",icon:"question",showCancelButton:!0,confirmButtonText:"Excel",cancelButtonText:"CSV",showDenyButton:!0,denyButtonText:"پیشرفته",showCloseButton:!0,reverseButtons:!0});o.isConfirmed?await b():o.isDismissed&&o.dismiss===a.DismissReason.cancel?await g():o.isDenied&&await y()},b=async()=>{r.value=!0;try{const o=v();await x.exportToExcel(o),await a.fire({icon:"success",title:"موفقیت‌آمیز!",text:"فایل Excel با موفقیت دانلود شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(o){console.error("Export error:",o),await a.fire({icon:"error",title:"خطا!",text:"خطا در خروجی گرفتن فایل Excel",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{r.value=!1}},g=async()=>{r.value=!0;try{const o=v();await x.exportToCSV(o),await a.fire({icon:"success",title:"موفقیت‌آمیز!",text:"فایل CSV با موفقیت دانلود شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(o){console.error("Export error:",o),await a.fire({icon:"error",title:"خطا!",text:"خطا در خروجی گرفتن فایل CSV",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{r.value=!1}},y=async()=>{r.value=!0;try{const o=v();await x.exportAdvancedReport(o),await a.fire({icon:"success",title:"موفقیت‌آمیز!",text:"گزارش پیشرفته با موفقیت دانلود شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(o){console.error("Export error:",o),await a.fire({icon:"error",title:"خطا!",text:"خطا در خروجی گرفتن گزارش پیشرفته",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{r.value=!1}},j=()=>{s.value={startDate:"",endDate:"",status:"",system:"",priority:"",assignedTo:""}};return z(async()=>{var o;((o=S.value)==null?void 0:o.role)!=="customer"&&await f.fetchUsers()}),(o,t)=>(i(),n("div",null,[t[22]||(t[22]=e("div",{class:"mb-6 flex justify-between items-center"},[e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"گزارش‌ها و خروجی"),e("p",{class:"text-gray-600 mt-2"},"تولید و دریافت گزارش‌های مختلف")])],-1)),e("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},[e("div",{class:"card hover-lift cursor-pointer",onClick:b},[...t[6]||(t[6]=[u('<div class="flex flex-col items-center text-center p-6"><div class="bg-green-100 rounded-full p-4 mb-4"><svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-bold text-gray-900 mb-2">خروجی Excel</h3><p class="text-gray-600 text-sm">خروجی کامل درخواست‌ها به فرمت Excel</p></div>',1)])]),e("div",{class:"card hover-lift cursor-pointer",onClick:g},[...t[7]||(t[7]=[u('<div class="flex flex-col items-center text-center p-6"><div class="bg-blue-100 rounded-full p-4 mb-4"><svg class="w-12 h-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-bold text-gray-900 mb-2">خروجی CSV</h3><p class="text-gray-600 text-sm">خروجی کامل درخواست‌ها به فرمت CSV</p></div>',1)])]),e("div",{class:"card hover-lift cursor-pointer",onClick:y},[...t[8]||(t[8]=[u('<div class="flex flex-col items-center text-center p-6"><div class="bg-purple-100 rounded-full p-4 mb-4"><svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-bold text-gray-900 mb-2">گزارش پیشرفته</h3><p class="text-gray-600 text-sm">گزارش Excel با چندین برگه و دسته‌بندی</p></div>',1)])])]),e("div",R,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"فیلترهای گزارش",-1)),e("div",F,[e("div",null,[t[9]||(t[9]=e("label",{class:"label"},"از تاریخ",-1)),k(T,{modelValue:s.value.startDate,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.startDate=l),placeholder:"1403/01/01"},null,8,["modelValue"])]),e("div",null,[t[10]||(t[10]=e("label",{class:"label"},"تا تاریخ",-1)),k(T,{modelValue:s.value.endDate,"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.endDate=l),placeholder:"1403/12/29"},null,8,["modelValue"])]),e("div",null,[t[12]||(t[12]=e("label",{class:"label"},"وضعیت",-1)),d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.status=l),class:"input"},[...t[11]||(t[11]=[e("option",{value:""},"همه",-1),e("option",{value:"باز"},"باز",-1),e("option",{value:"در درست اقدام"},"در درست اقدام",-1),e("option",{value:"انجام"},"انجام",-1)])],512),[[p,s.value.status]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"label"},"سیستم",-1)),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.system=l),class:"input"},[t[13]||(t[13]=e("option",{value:""},"همه",-1)),(i(!0),n(V,null,B(A(P),l=>(i(),n("option",{key:l,value:l},m(l),9,G))),128))],512),[[p,s.value.system]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"اولویت",-1)),d(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.priority=l),class:"input"},[...t[15]||(t[15]=[u('<option value="">همه</option><option value="کم">کم</option><option value="متوسط">متوسط</option><option value="زیاد">زیاد</option><option value="فوری">فوری</option>',5)])],512),[[p,s.value.priority]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"اختصاص یافته به",-1)),d(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.assignedTo=l),class:"input"},[t[17]||(t[17]=e("option",{value:""},"همه",-1)),(i(!0),n(V,null,B(h.value,l=>(i(),n("option",{key:l._id,value:l._id},m(l.name),9,I))),128))],512),[[p,s.value.assignedTo]])]),e("div",{class:"flex items-end"},[e("button",{onClick:j,class:"btn btn-secondary w-full"},"پاک کردن فیلترها")])])]),e("div",L,[e("button",{onClick:U,class:"btn btn-primary text-lg px-8 py-4",disabled:r.value},[r.value?(i(),n("span",Y,[...t[20]||(t[20]=[e("span",{class:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):(i(),n("span",J,[...t[21]||(t[21]=[e("svg",{class:"w-6 h-6 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])),H(" "+m(r.value?"در حال تولید گزارش...":"تولید گزارش با فیلترهای انتخاب شده"),1)],8,q)])]))}};export{tt as default};
