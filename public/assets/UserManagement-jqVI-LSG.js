import{r as p,A as M,k as j,c as o,a as e,j as S,h as i,F as T,p as V,w as D,f as m,v as x,I as L,o as n,t as d,q as g}from"./index-NaxcUE6C.js";import{u as q}from"./users-BxaSixr-.js";import{b as E}from"./constants-CjjkXsVG.js";import{d as b}from"./dateUtils-B4onfrge.js";import{S as v}from"./sweetalert2.esm.all-ePrzfkxH.js";const A={class:"mb-6 flex justify-between items-center"},Y={class:"card"},$={key:0,class:"text-center py-20"},F={key:1,class:"overflow-x-auto"},H={class:"min-w-full"},N={class:"bg-white divide-y divide-gray-200"},z={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},I={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},R={class:"px-6 py-4 whitespace-nowrap text-sm"},J={class:"px-6 py-4 whitespace-nowrap text-sm"},O={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},G={class:"px-6 py-4 whitespace-nowrap text-sm space-x-2 space-x-reverse"},K=["onClick"],P=["onClick"],Q={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},W={class:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto"},X={class:"space-y-4"},Z={class:"flex justify-end space-x-4 space-x-reverse mt-6"},ee=["disabled"],ne={__name:"UserManagement",setup(te){const u=q(),l=p(!1),c=p(!1),y=p(null),w=M(()=>u.users),r=p({name:"",username:"",password:"",role:"user"}),h=a=>E[a]||a,k=a=>a?typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a)?b.gregorianToJalali(a):b.formatDate(a,"jYYYY/jMM/jDD HH:mm"):"-",f=()=>{c.value=!1,y.value=null,r.value={name:"",username:"",password:"",role:"user"}},_=async()=>{l.value=!0;try{await u.createUser(r.value),f()}catch(a){console.error("Error creating user:",a)}finally{l.value=!1}},C=a=>{y.value=a._id,r.value={name:a.name,username:a.username,password:"",role:a.role},c.value=!0},B=async a=>{if((await v.fire({title:"آیا از حذف این کاربر اطمینان دارید؟",text:"این عملیات قابل برگشت نیست.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، حذف کن",cancelButtonText:"لغو",reverseButtons:!0})).isConfirmed)try{await u.deleteUser(a),await v.fire({icon:"success",title:"موفقیت‌آمیز!",text:"کاربر با موفقیت حذف شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(s){console.error("Error deleting user:",s),await v.fire({icon:"error",title:"خطا!",text:"خطا در حذف کاربر",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}};return j(async()=>{l.value=!0;try{await u.fetchUsers()}finally{l.value=!1}}),(a,t)=>(n(),o("div",null,[e("div",A,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"مدیریت کاربران"),e("p",{class:"text-gray-600 mt-2"},"مدیریت و ویرایش کاربران سیستم")],-1)),e("button",{onClick:t[0]||(t[0]=s=>c.value=!0),class:"btn btn-primary"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5 inline ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),i(" کاربر جدید ",-1)])])]),e("div",Y,[l.value?(n(),o("div",$,[...t[7]||(t[7]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1)])])):(n(),o("div",F,[e("table",H,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نام"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نام کاربری"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نقش"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"وضعیت"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"آخرین ورود"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"عملیات")])],-1)),e("tbody",N,[(n(!0),o(T,null,V(w.value,s=>(n(),o("tr",{key:s._id,class:"hover:bg-gray-50"},[e("td",z,d(s.name),1),e("td",I,d(s.username),1),e("td",R,[e("span",{class:g(["badge",s.role==="admin"?"badge-warning":"badge-info"])},d(h(s.role)),3)]),e("td",J,[e("span",{class:g(s.isActive?"badge badge-success":"badge badge-danger")},d(s.isActive?"فعال":"غیرفعال"),3)]),e("td",O,d(k(s.lastLogin)),1),e("td",G,[e("button",{onClick:U=>C(s),class:"text-blue-600 hover:text-blue-900"}," ویرایش ",8,K),e("button",{onClick:U=>B(s._id),class:"text-red-600 hover:text-red-900"}," حذف ",8,P)])]))),128))])])]))]),c.value?(n(),o("div",Q,[e("div",W,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"کاربر جدید",-1)),e("form",{onSubmit:D(_,["prevent"])},[e("div",X,[e("div",null,[t[9]||(t[9]=e("label",{class:"label"},[i("نام "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.name=s),type:"text",class:"input",required:""},null,512),[[x,r.value.name]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"label"},[i("نام کاربری "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.username=s),type:"text",class:"input",required:""},null,512),[[x,r.value.username]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"label"},[i("رمز عبور "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.password=s),type:"password",class:"input",required:""},null,512),[[x,r.value.password]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"label"},[i("نقش "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.role=s),class:"input",required:""},[...t[12]||(t[12]=[e("option",{value:"user"},"کاربر",-1),e("option",{value:"admin"},"مدیر",-1)])],512),[[L,r.value.role]])])]),e("div",Z,[e("button",{type:"button",onClick:f,class:"btn btn-secondary"}," انصراف "),e("button",{type:"submit",class:"btn btn-primary",disabled:l.value}," ایجاد کاربر ",8,ee)])],32)])])):S("",!0)]))}};export{ne as default};
