import{y,u as M,r as V,B as g,k as O,c as p,a as o,b as f,d as D,f as x,K as b,F as S,p as U,H as A,h as I,t as k,o as m}from"./index-B1RxePN7.js";import{u as H}from"./users-D1WZpKAU.js";import{b as z}from"./constants-CFvVWKro.js";import{d as R}from"./dateUtils-KBV2qcdl.js";import{P as E}from"./PersianDatePicker-DEF6n3RS.js";import{S as c}from"./sweetalert2.esm.all-ePrzfkxH.js";const T={async exportToExcel(v={}){const r=await y.get("/reports/export/excel",{params:v,responseType:"blob"}),u=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(u),t=document.createElement("a");t.href=n;const i=r.headers["content-disposition"];let d=`درخواست‌ها_${new Date().toISOString().split("T")[0]}.xlsx`;if(i){const a=i.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);a&&a[1]&&(d=decodeURIComponent(a[1].replace(/['"]/g,"")))}return t.setAttribute("download",d),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(n),{success:!0}},async exportToCSV(v={}){const r=await y.get("/reports/export/csv",{params:v,responseType:"blob"}),u=new Blob([r.data],{type:"text/csv; charset=utf-8"}),n=window.URL.createObjectURL(u),t=document.createElement("a");t.href=n;const i=r.headers["content-disposition"];let d=`درخواست‌ها_${new Date().toISOString().split("T")[0]}.csv`;if(i){const a=i.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);a&&a[1]&&(d=decodeURIComponent(a[1].replace(/['"]/g,"")))}return t.setAttribute("download",d),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(n),{success:!0}},async exportAdvancedReport(v={}){const r=await y.get("/reports/export/advanced",{params:v,responseType:"blob"}),u=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(u),t=document.createElement("a");t.href=n;const i=r.headers["content-disposition"];let d=`گزارش_پیشرفته_${new Date().toISOString().split("T")[0]}.xlsx`;if(i){const a=i.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);a&&a[1]&&(d=decodeURIComponent(a[1].replace(/['"]/g,"")))}return t.setAttribute("download",d),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(n),{success:!0}}},N={class:"card mb-6"},P={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},F=["value"],$=["value"],G={class:"text-center"},q=["disabled"],K={key:0,class:"mr-2"},Y={key:1,class:"mr-2"},ee={__name:"Reports",setup(v){const r=M(),u=H(),n=V(!1),t=V({startDate:"",endDate:"",status:"",system:"",priority:"",assignedTo:""}),i=g(()=>r.user),d=g(()=>u.users),a=g(()=>d.value.filter(s=>s.role==="admin"||s.role==="user")),w=()=>{const s={};return t.value.startDate&&(s.startDate=R.jalaliToGregorian(t.value.startDate)),t.value.endDate&&(s.endDate=R.jalaliToGregorian(t.value.endDate)),t.value.status&&(s.status=t.value.status),t.value.system&&(s.system=t.value.system),t.value.priority&&(s.priority=t.value.priority),t.value.assignedTo&&(s.assignedTo=t.value.assignedTo),s},L=async()=>{const s=await c.fire({title:"انتخاب نوع گزارش",text:"لطفا نوع گزارش مورد نظر را انتخاب کنید",icon:"question",showCancelButton:!0,confirmButtonText:"Excel",cancelButtonText:"CSV",showDenyButton:!0,denyButtonText:"پیشرفته",showCloseButton:!0,reverseButtons:!0});s.isConfirmed?await C():s.isDismissed&&s.dismiss===c.DismissReason.cancel?await h():s.isDenied&&await B()},C=async()=>{n.value=!0;try{const s=w();await T.exportToExcel(s),await c.fire({icon:"success",title:"موفقیت‌آمیز!",text:"فایل Excel با موفقیت دانلود شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(s){console.error("Export error:",s),await c.fire({icon:"error",title:"خطا!",text:"خطا در خروجی گرفتن فایل Excel",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{n.value=!1}},h=async()=>{n.value=!0;try{const s=w();await T.exportToCSV(s),await c.fire({icon:"success",title:"موفقیت‌آمیز!",text:"فایل CSV با موفقیت دانلود شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(s){console.error("Export error:",s),await c.fire({icon:"error",title:"خطا!",text:"خطا در خروجی گرفتن فایل CSV",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{n.value=!1}},B=async()=>{n.value=!0;try{const s=w();await T.exportAdvancedReport(s),await c.fire({icon:"success",title:"موفقیت‌آمیز!",text:"گزارش پیشرفته با موفقیت دانلود شد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(s){console.error("Export error:",s),await c.fire({icon:"error",title:"خطا!",text:"خطا در خروجی گرفتن گزارش پیشرفته",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{n.value=!1}},j=()=>{t.value={startDate:"",endDate:"",status:"",system:"",priority:"",assignedTo:""}};return O(async()=>{var s;((s=i.value)==null?void 0:s.role)!=="customer"&&await u.fetchUsers()}),(s,e)=>(m(),p("div",null,[e[22]||(e[22]=o("div",{class:"mb-6 flex justify-between items-center"},[o("div",null,[o("h1",{class:"text-3xl font-bold text-gray-900"},"گزارش‌ها و خروجی"),o("p",{class:"text-gray-600 mt-2"},"تولید و دریافت گزارش‌های مختلف")])],-1)),o("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},[o("div",{class:"card hover-lift cursor-pointer",onClick:C},[...e[6]||(e[6]=[f('<div class="flex flex-col items-center text-center p-6"><div class="bg-green-100 rounded-full p-4 mb-4"><svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-bold text-gray-900 mb-2">خروجی Excel</h3><p class="text-gray-600 text-sm">خروجی کامل درخواست‌ها به فرمت Excel</p></div>',1)])]),o("div",{class:"card hover-lift cursor-pointer",onClick:h},[...e[7]||(e[7]=[f('<div class="flex flex-col items-center text-center p-6"><div class="bg-blue-100 rounded-full p-4 mb-4"><svg class="w-12 h-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-bold text-gray-900 mb-2">خروجی CSV</h3><p class="text-gray-600 text-sm">خروجی کامل درخواست‌ها به فرمت CSV</p></div>',1)])]),o("div",{class:"card hover-lift cursor-pointer",onClick:B},[...e[8]||(e[8]=[f('<div class="flex flex-col items-center text-center p-6"><div class="bg-purple-100 rounded-full p-4 mb-4"><svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-bold text-gray-900 mb-2">گزارش پیشرفته</h3><p class="text-gray-600 text-sm">گزارش Excel با چندین برگه و دسته‌بندی</p></div>',1)])])]),o("div",N,[e[19]||(e[19]=o("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"فیلترهای گزارش",-1)),o("div",P,[o("div",null,[e[9]||(e[9]=o("label",{class:"label"},"از تاریخ",-1)),D(E,{modelValue:t.value.startDate,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.startDate=l),placeholder:"1403/01/01"},null,8,["modelValue"])]),o("div",null,[e[10]||(e[10]=o("label",{class:"label"},"تا تاریخ",-1)),D(E,{modelValue:t.value.endDate,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.endDate=l),placeholder:"1403/12/29"},null,8,["modelValue"])]),o("div",null,[e[12]||(e[12]=o("label",{class:"label"},"وضعیت",-1)),x(o("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.status=l),class:"input"},[...e[11]||(e[11]=[o("option",{value:""},"همه",-1),o("option",{value:"باز"},"باز",-1),o("option",{value:"در درست اقدام"},"در درست اقدام",-1),o("option",{value:"انجام"},"انجام",-1)])],512),[[b,t.value.status]])]),o("div",null,[e[14]||(e[14]=o("label",{class:"label"},"سیستم",-1)),x(o("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.system=l),class:"input"},[e[13]||(e[13]=o("option",{value:""},"همه",-1)),(m(!0),p(S,null,U(A(z),l=>(m(),p("option",{key:l,value:l},k(l),9,F))),128))],512),[[b,t.value.system]])]),o("div",null,[e[16]||(e[16]=o("label",{class:"label"},"اولویت",-1)),x(o("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.priority=l),class:"input"},[...e[15]||(e[15]=[f('<option value="">همه</option><option value="کم">کم</option><option value="متوسط">متوسط</option><option value="زیاد">زیاد</option><option value="فوری">فوری</option>',5)])],512),[[b,t.value.priority]])]),o("div",null,[e[18]||(e[18]=o("label",{class:"label"},"اختصاص یافته به",-1)),x(o("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.assignedTo=l),class:"input"},[e[17]||(e[17]=o("option",{value:""},"همه",-1)),(m(!0),p(S,null,U(a.value,l=>(m(),p("option",{key:l._id,value:l._id},k(l.name),9,$))),128))],512),[[b,t.value.assignedTo]])]),o("div",{class:"flex items-end"},[o("button",{onClick:j,class:"btn btn-secondary w-full"},"پاک کردن فیلترها")])])]),o("div",G,[o("button",{onClick:L,class:"btn btn-primary text-lg px-8 py-4",disabled:n.value},[n.value?(m(),p("span",K,[...e[20]||(e[20]=[o("span",{class:"inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):(m(),p("span",Y,[...e[21]||(e[21]=[o("svg",{class:"w-6 h-6 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])),I(" "+k(n.value?"در حال تولید گزارش...":"تولید گزارش با فیلترهای انتخاب شده"),1)],8,q)])]))}};export{ee as default};
