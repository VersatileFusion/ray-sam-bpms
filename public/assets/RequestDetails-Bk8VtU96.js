import{r as y,k as le,c as l,o as a,a as e,F as q,p as B,q as ae,j as b,t as n,y as fe,A as E,E as te,w as A,u as xe,L as ke,i as we,d as H,e as he,B as _e,f as w,v as S,I,C as se,h as qe}from"./index-NaxcUE6C.js";import{d as z}from"./dateUtils-B4onfrge.js";import{u as Be}from"./requests-DO-BLg5z.js";import{u as Ce}from"./users-BxaSixr-.js";import{a as De,R as Se,S as L}from"./constants-CjjkXsVG.js";import{S as T}from"./sweetalert2.esm.all-ePrzfkxH.js";const Te={class:"space-y-4"},$e={key:0,class:"text-center py-8"},je={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ee={key:2,class:"relative"},Me={class:"space-y-6"},Ue={class:"flex-1 min-w-0 bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700"},Re={class:"flex items-start justify-between"},Ne={class:"flex-1"},Ie={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ve={key:0,class:"mt-2 text-xs text-gray-600 dark:text-gray-400"},Pe={key:0},Ae={key:1},Oe={class:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap mr-3"},Ye={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},He={__name:"ActivityTimeline",props:{requestId:{type:String,required:!0}},setup(h){const M=h,c=y([]),m=y(!1),f=i=>({created:"bg-green-100 dark:bg-green-900/30",updated:"bg-blue-100 dark:bg-blue-900/30",status_changed:"bg-purple-100 dark:bg-purple-900/30",assigned:"bg-yellow-100 dark:bg-yellow-900/30",comment_added:"bg-indigo-100 dark:bg-indigo-900/30",closed:"bg-gray-100 dark:bg-gray-700",reopened:"bg-orange-100 dark:bg-orange-900/30"})[i]||"bg-gray-100 dark:bg-gray-700",_=i=>i?z.formatDate(i,"jYYYY/jMM/jDD HH:mm"):"",d=async()=>{m.value=!0;try{const i=await fe.get(`/requests/${M.requestId}/activities`);i.data.success&&(c.value=i.data.data||[])}catch(i){console.error("Error loading activities:",i)}finally{m.value=!1}};return le(()=>{d()}),(i,v)=>(a(),l("div",Te,[v[4]||(v[4]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-4"},"زمان‌خط فعالیت",-1)),m.value?(a(),l("div",$e,[...v[0]||(v[0]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):c.value.length===0?(a(),l("div",je,[...v[1]||(v[1]=[e("p",null,"فعالیتی ثبت نشده است",-1)])])):(a(),l("div",Ee,[v[3]||(v[3]=e("div",{class:"absolute right-4 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700"},null,-1)),e("div",Me,[(a(!0),l(q,null,B(c.value,g=>{var k;return a(),l("div",{key:g._id,class:"relative flex items-start space-x-4 space-x-reverse"},[e("div",{class:ae(["relative z-10 flex items-center justify-center w-8 h-8 rounded-full",f(g.action)])},[...v[2]||(v[2]=[e("div",{class:"w-3 h-3 rounded-full bg-white dark:bg-gray-800"},null,-1)])],2),e("div",Ue,[e("div",Re,[e("div",Ne,[e("p",Ie,n(g.description),1),g.changes&&Object.keys(g.changes).length>0?(a(),l("div",Ve,[(a(!0),l(q,null,B(g.changes,(p,x)=>(a(),l("span",{key:x,class:"mr-3"},[e("strong",null,n(x)+":",1),typeof p=="object"?(a(),l("span",Pe,n(p.from)+" → "+n(p.to),1)):(a(),l("span",Ae,n(p),1))]))),128))])):b("",!0)]),e("span",Oe,n(_(g.createdAt)),1)]),e("div",Ye," توسط: "+n(((k=g.performedBy)==null?void 0:k.name)||"سیستم"),1)])])}),128))])]))]))}},Le={class:"relative max-w-7xl max-h-full"},ze=["src","alt"],Fe={key:0,class:"absolute inset-0 flex items-center justify-between p-4 pointer-events-none"},Ge={__name:"ImagePreview",props:{isOpen:{type:Boolean,default:!1},imageUrl:{type:String,required:!0},images:{type:Array,default:null},alt:{type:String,default:"تصویر"},navigation:{type:Boolean,default:!1}},emits:["close","update:isOpen"],setup(h,{emit:M}){const c=h,m=M,f=y(0),_=y(!1);E(()=>{var p;return c.images&&c.images.length>0?((p=c.images[f.value])==null?void 0:p.url)||c.images[f.value]:c.imageUrl});const d=()=>{_.value=!0},i=()=>{f.value>0&&(f.value--,_.value=!1)},v=()=>{c.images&&f.value<c.images.length-1&&(f.value++,_.value=!1)},g=()=>{m("close"),m("update:isOpen",!1)},k=p=>{c.isOpen&&(p.key==="Escape"?g():p.key==="ArrowLeft"&&c.navigation&&c.images?i():p.key==="ArrowRight"&&c.navigation&&c.images&&v())};return te(()=>c.isOpen,p=>{p?(document.addEventListener("keydown",k),f.value=0,_.value=!1):document.removeEventListener("keydown",k)}),te(()=>c.imageUrl,()=>{f.value=0,_.value=!1}),(p,x)=>h.isOpen?(a(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 z-[9999] flex items-center justify-center p-4",onClick:A(g,["self"])},[e("div",Le,[e("button",{onClick:g,class:"absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors"},[...x[0]||(x[0]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),e("img",{src:h.imageUrl,alt:h.alt,class:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",onError:d},null,40,ze),h.navigation&&h.images&&h.images.length>1?(a(),l("div",Fe,[f.value>0?(a(),l("button",{key:0,onClick:i,class:"pointer-events-auto bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2 text-white transition-all"},[...x[1]||(x[1]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):b("",!0),f.value<h.images.length-1?(a(),l("button",{key:1,onClick:v,class:"pointer-events-auto bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2 text-white transition-all"},[...x[2]||(x[2]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):b("",!0)])):b("",!0)])])):b("",!0)}},Ke={key:0,class:"text-center py-20"},Je={key:1},Qe={class:"mb-6 flex justify-between items-center"},We={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Xe={class:"md:col-span-2 space-y-6"},Ze={class:"card"},et={class:"space-y-4"},tt={class:"text-gray-900 font-medium"},st={class:"text-gray-900 font-medium"},lt={key:0},at={class:"text-gray-900 font-medium"},ot={class:"text-gray-900 font-medium"},rt={class:"text-gray-900 font-medium"},nt={class:"text-gray-900 font-medium"},it={class:"text-gray-900"},ut={class:"text-gray-900"},dt={key:1},vt={class:"text-gray-900"},ct={class:"card"},mt={class:"card"},pt={class:"mb-6"},gt={class:"flex gap-2"},yt=["disabled"],bt={key:0,class:"space-y-4"},ft={class:"flex justify-between items-start mb-2"},xt={class:"font-medium text-gray-900"},kt={class:"text-sm text-gray-500"},wt={class:"text-gray-700 whitespace-pre-wrap"},ht={key:1,class:"text-gray-500 text-center py-8"},_t={class:"card"},qt={key:0,class:"mb-4"},Bt={class:"flex gap-2"},Ct=["disabled"],Dt={key:1,class:"space-y-2"},St={class:"flex items-center gap-3"},Tt={key:0,class:"w-6 h-6 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$t=["src","onClick","alt"],jt={class:"font-medium text-gray-900 dark:text-gray-100"},Et={class:"text-xs text-gray-500 dark:text-gray-400"},Mt={class:"flex items-center gap-2"},Ut=["onClick"],Rt=["href"],Nt={key:2,class:"text-gray-500 text-center py-8"},It={class:"space-y-6"},Vt={class:"card"},Pt={class:"space-y-4"},At={key:0},Ot=["disabled"],Yt=["disabled"],Ht={class:"font-medium"},Lt={key:1},zt={class:"font-medium"},Ft={key:2},Gt=["disabled"],Kt=["value"],Jt=["disabled"],Qt={key:0,class:"card"},Wt={class:"space-y-3"},Xt={key:1,class:"card"},Zt=["value"],es=["value"],ts={class:"flex gap-2"},ss=["disabled"],ls={class:"card"},as={class:"space-y-3 text-sm"},os={class:"font-medium"},rs={class:"font-medium"},ns={class:"font-medium"},is={class:"card"},us={class:"flex justify-between items-center mb-4"},ds={key:0},vs={key:0,class:"text-center py-4"},cs={key:1,class:"text-gray-500 text-center py-4"},ms={key:2,class:"space-y-3 max-h-64 overflow-y-auto"},ps={class:"flex justify-between items-start mb-2"},gs={class:"font-medium text-gray-900"},ys={class:"text-xs text-gray-500"},bs={class:"space-y-1 text-sm"},fs={class:"text-gray-600"},xs={class:"line-through text-red-500 ml-2"},ks={class:"text-green-600"},ws={key:2,class:"text-center py-20"},Ss={__name:"RequestDetails",setup(h){const M=ke(),c=we(),m=Be(),f=xe(),_=Ce(),d=y(!1),i=E(()=>M.params.id),v=y(""),g=y(""),k=y(!1),p=y(!1),x=y(!1),V=y([]),O=y(null),U=y(null),C=y(""),F=y(!1),oe=y(""),o=E(()=>m.currentRequest),D=E(()=>f.user),re=E(()=>_.users),ne=E(()=>re.value.filter(r=>r.role==="admin"||r.role==="user")),u=y({customerName:"",customerPhone:"",userName:"",system:"",requestType:"",priority:"",request:"",actionDescription:"",closeDescription:""}),ie=r=>({[L.OPEN]:"badge badge-info",[L.IN_PROGRESS]:"badge badge-warning",[L.COMPLETED]:"badge badge-success"})[r]||"badge badge-secondary",R=r=>{if(!r)return"";if(typeof r=="string"&&(/^\d{4}-\d{2}-\d{2}$/.test(r)||/^\d{4}\/\d{2}\/\d{2}$/.test(r))){const t=r.includes("-")?r:r.replace(/\//g,"-");return z.gregorianToJalali(t)}return z.formatDate(r,"jYYYY/jMM/jDD HH:mm")},ue=async()=>{if(!(!v.value||v.value===o.value.status||!(await T.fire({title:"آیا از تغییر وضعیت اطمینان دارید؟",text:"این عملیات قابل برگشت نیست.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، تغییر دهید",cancelButtonText:"لغو",reverseButtons:!0})).isConfirmed)){d.value=!0;try{await m.updateRequest(i.value,{status:v.value}),await m.fetchRequest(i.value),v.value="",await T.fire({icon:"success",title:"موفقیت‌آمیز!",text:"وضعیت درخواست با موفقیت تغییر کرد.",confirmButtonText:"باشه",confirmButtonColor:"#3085d6"})}catch(t){console.error("Error updating status:",t),await T.fire({icon:"error",title:"خطا!",text:"خطا در تغییر وضعیت",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}},de=async()=>{if(!(!g.value||!g.value.trim())){d.value=!0;try{const r=await m.addComment(i.value,g.value);g.value="",await m.fetchRequest(i.value)}catch(r){console.error("Error adding comment:",r),await T.fire({icon:"error",title:"خطا!",text:"خطا در ثبت نظر",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}},G=()=>{k.value||(u.value={customerName:o.value.customerName||"",customerPhone:o.value.customerPhone||"",userName:o.value.userName||"",system:o.value.system||"",requestType:o.value.requestType||"",priority:o.value.priority||"",request:o.value.request||"",actionDescription:o.value.actionDescription||"",closeDescription:o.value.closeDescription||""}),k.value=!k.value},ve=async()=>{d.value=!0;try{const r={customerPhone:u.value.customerPhone,requestType:u.value.requestType,priority:u.value.priority,request:u.value.request,actionDescription:u.value.actionDescription,closeDescription:u.value.closeDescription};await m.updateRequest(i.value,r),k.value=!1,await m.fetchRequest(i.value)}catch(r){console.error("Error updating request:",r),await T.fire({icon:"error",title:"خطا!",text:"خطا در ویرایش درخواست",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}},ce=async()=>{if(p.value=!p.value,p.value&&V.value.length===0){x.value=!0;try{const r=await m.getRequestHistory(i.value);V.value=r}catch(r){console.error("Error loading history:",r)}finally{x.value=!1}}},me=r=>{U.value=r.target.files[0]},pe=async()=>{if(U.value){d.value=!0;try{await m.uploadAttachment(i.value,U.value),U.value=null,O.value&&(O.value.value=""),await m.fetchRequest(i.value)}catch(r){console.error("Error uploading attachment:",r),await T.fire({icon:"error",title:"خطا!",text:"خطا در آپلود فایل",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}},ge=r=>{if(!r)return"0 B";const t=1024,$=["B","KB","MB","GB"],N=Math.floor(Math.log(r)/Math.log(t));return Math.round(r/Math.pow(t,N)*100)/100+" "+$[N]},ye=async()=>{if(C.value){d.value=!0;try{await m.assignRequest(i.value,C.value),await m.fetchRequest(i.value),C.value=""}catch(r){console.error("Error assigning request:",r),await T.fire({icon:"error",title:"خطا!",text:"خطا در اختصاص درخواست",confirmButtonText:"باشه",confirmButtonColor:"#d33"})}finally{d.value=!1}}};return le(async()=>{var r,t,$;d.value=!0;try{((r=D.value)==null?void 0:r.role)!=="customer"&&await _.fetchUsers(),await m.fetchRequest(i.value),o.value&&(v.value=o.value.status,C.value=((t=o.value.assignedTo)==null?void 0:t.userId)||""),o.value&&(($=D.value)==null?void 0:$.role)==="customer"&&o.value.createdBy.userId!==D.value._id&&c.push("/requests")}finally{d.value=!1}}),(r,t)=>{var N,K,J,Q,W,X,Z,ee;const $=_e("router-link");return a(),l("div",null,[d.value?(a(),l("div",Ke,[...t[13]||(t[13]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1)])])):o.value?(a(),l("div",Je,[e("div",Qe,[t[15]||(t[15]=e("h1",{class:"text-3xl font-bold text-gray-900"},"جزئیات درخواست",-1)),H($,{to:"/requests",class:"btn btn-secondary"},{default:he(()=>[...t[14]||(t[14]=[qe(" بازگشت به لیست ",-1)])]),_:1})]),e("div",We,[e("div",Xe,[e("div",Ze,[t[25]||(t[25]=e("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"اطلاعات درخواست",-1)),e("div",et,[e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm text-gray-600"},"تاریخ:",-1)),e("p",tt,n(R(o.value.date)),1)]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-sm text-gray-600"},"نام مشتری:",-1)),e("p",st,n(o.value.customerName),1)]),o.value.customerPhone?(a(),l("div",lt,[t[18]||(t[18]=e("label",{class:"text-sm text-gray-600"},"شماره تماس:",-1)),e("p",at,n(o.value.customerPhone),1)])):b("",!0),e("div",null,[t[19]||(t[19]=e("label",{class:"text-sm text-gray-600"},"نام کاربر:",-1)),e("p",ot,n(o.value.userName),1)]),e("div",null,[t[20]||(t[20]=e("label",{class:"text-sm text-gray-600"},"سیستم:",-1)),e("p",rt,n(o.value.system),1)]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-sm text-gray-600"},"نوع درخواست:",-1)),e("p",nt,n(o.value.requestType),1)]),e("div",null,[t[22]||(t[22]=e("label",{class:"text-sm text-gray-600"},"درخواست:",-1)),e("p",it,n(o.value.request),1)]),e("div",null,[t[23]||(t[23]=e("label",{class:"text-sm text-gray-600"},"شرح اقدام:",-1)),e("p",ut,n(o.value.actionDescription),1)]),o.value.closeDescription?(a(),l("div",dt,[t[24]||(t[24]=e("label",{class:"text-sm text-gray-600"},"شرح بستن:",-1)),e("p",vt,n(o.value.closeDescription),1)])):b("",!0)])]),e("div",ct,[H(He,{"request-id":o.value._id},null,8,["request-id"])]),e("div",mt,[t[26]||(t[26]=e("h2",{class:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4"},"نظرات",-1)),e("div",pt,[e("form",{onSubmit:A(de,["prevent"])},[e("div",gt,[w(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),class:"input flex-1",rows:"3",placeholder:"نظر خود را بنویسید...",required:""},null,512),[[S,g.value]]),e("button",{type:"submit",class:"btn btn-primary px-4",disabled:d.value}," ارسال ",8,yt)])],32)]),o.value.comments&&o.value.comments.length>0?(a(),l("div",bt,[(a(!0),l(q,null,B(o.value.comments,s=>{var j;return a(),l("div",{key:s._id||((j=s._id)==null?void 0:j.toString())||Math.random(),class:"border-b border-gray-200 pb-4"},[e("div",ft,[e("span",xt,n(s.createdBy.name),1),e("span",kt,n(R(s.createdAt)),1)]),e("p",wt,n(s.text),1)])}),128))])):(a(),l("div",ht," نظری ثبت نشده است "))]),e("div",_t,[t[28]||(t[28]=e("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"پیوست‌ها",-1)),((N=D.value)==null?void 0:N.role)!=="customer"?(a(),l("div",qt,[e("form",{onSubmit:A(pe,["prevent"])},[e("div",Bt,[e("input",{ref_key:"fileInput",ref:O,type:"file",class:"input flex-1",onChange:me,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},null,544),e("button",{type:"submit",class:"btn btn-primary px-4",disabled:d.value||!U.value}," آپلود ",8,Ct)])],32)])):b("",!0),o.value.attachments&&o.value.attachments.length>0?(a(),l("div",Dt,[(a(!0),l(q,null,B(o.value.attachments,(s,j)=>(a(),l("div",{key:j,class:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800"},[e("div",St,[r.isImage(s.mimetype)?(a(),l("img",{key:1,src:`/uploads/${s.filename}`,onClick:P=>r.openImagePreview(`/uploads/${s.filename}`),class:"w-12 h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",alt:s.originalName},null,8,$t)):(a(),l("svg",Tt,[...t[27]||(t[27]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])),e("div",null,[e("p",jt,n(s.originalName),1),e("p",Et,n(ge(s.size)),1)])]),e("div",Mt,[r.isImage(s.mimetype)?(a(),l("button",{key:0,onClick:P=>r.openImagePreview(`/uploads/${s.filename}`),class:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 text-sm px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20"}," مشاهده ",8,Ut)):b("",!0),e("a",{href:`/uploads/${s.filename}`,target:"_blank",class:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 text-sm px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20",download:""}," دانلود ",8,Rt)])]))),128))])):(a(),l("div",Nt," پیوستی وجود ندارد "))])]),e("div",It,[e("div",Vt,[t[35]||(t[35]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"وضعیت",-1)),e("div",Pt,[e("div",null,[e("span",{class:ae([ie(o.value.status),"block text-center"])},n(o.value.status),3)]),((K=D.value)==null?void 0:K.role)!=="customer"?(a(),l("div",At,[t[30]||(t[30]=e("label",{class:"label"},"تغییر وضعیت",-1)),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),class:"input",disabled:d.value},[...t[29]||(t[29]=[e("option",{value:""},"انتخاب کنید",-1),e("option",{value:"باز"},"باز",-1),e("option",{value:"در درست اقدام"},"در درست اقدام",-1),e("option",{value:"انجام"},"انجام",-1)])],8,Ot),[[I,v.value]]),v.value&&v.value!==o.value.status?(a(),l("button",{key:0,onClick:ue,class:"btn btn-success w-full mt-2 text-sm",disabled:d.value}," تغییر وضعیت ",8,Yt)):b("",!0)])):b("",!0),e("div",null,[t[31]||(t[31]=e("label",{class:"text-sm text-gray-600"},"اولویت:",-1)),e("p",Ht,n(o.value.priority),1)]),o.value.dueDate?(a(),l("div",Lt,[t[32]||(t[32]=e("label",{class:"text-sm text-gray-600"},"تاریخ سررسید:",-1)),e("p",zt,n(R(o.value.dueDate)),1)])):b("",!0),((J=D.value)==null?void 0:J.role)!=="customer"?(a(),l("div",Ft,[t[34]||(t[34]=e("label",{class:"label"},"اختصاص به:",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),class:"input",disabled:d.value},[t[33]||(t[33]=e("option",{value:""},"انتخاب کنید",-1)),(a(!0),l(q,null,B(ne.value,s=>(a(),l("option",{key:s._id,value:s._id},n(s.name),9,Kt))),128))],8,Gt),[[I,C.value]]),C.value&&C.value!==((Q=o.value.assignedTo)==null?void 0:Q.userId)?(a(),l("button",{key:0,onClick:ye,class:"btn btn-primary w-full mt-2 text-sm",disabled:d.value}," اختصاص درخواست ",8,Jt)):b("",!0)])):b("",!0)])]),((W=D.value)==null?void 0:W.role)!=="customer"?(a(),l("div",Qt,[t[36]||(t[36]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"عملیات سریع",-1)),e("div",Wt,[e("button",{onClick:G,class:"btn btn-secondary w-full"},n(k.value?"لغو ویرایش":"ویرایش درخواست"),1)])])):b("",!0),k.value&&((X=D.value)==null?void 0:X.role)!=="customer"?(a(),l("div",Xt,[t[49]||(t[49]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"ثبت اقدام",-1)),e("form",{onSubmit:A(ve,["prevent"]),class:"space-y-4"},[e("div",null,[t[37]||(t[37]=e("label",{class:"label"},"نام مشتری",-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value.customerName=s),type:"text",class:"input",disabled:""},null,512),[[S,u.value.customerName]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"label"},"شماره تماس",-1)),w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>u.value.customerPhone=s),type:"tel",class:"input"},null,512),[[S,u.value.customerPhone]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"label"},"نام کاربر",-1)),w(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>u.value.userName=s),type:"text",class:"input",disabled:""},null,512),[[S,u.value.userName]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"label"},"سیستم",-1)),w(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>u.value.system=s),class:"input",disabled:""},[t[40]||(t[40]=e("option",{value:""},"انتخاب کنید",-1)),(a(!0),l(q,null,B(se(De),s=>(a(),l("option",{key:s,value:s},n(s),9,Zt))),128))],512),[[I,u.value.system]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"label"},"نوع درخواست",-1)),w(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>u.value.requestType=s),class:"input",required:""},[t[42]||(t[42]=e("option",{value:""},"انتخاب کنید",-1)),(a(!0),l(q,null,B(se(Se),s=>(a(),l("option",{key:s,value:s},n(s),9,es))),128))],512),[[I,u.value.requestType]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"label"},"اولویت",-1)),w(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>u.value.priority=s),class:"input"},[...t[44]||(t[44]=[e("option",{value:"کم"},"کم",-1),e("option",{value:"متوسط"},"متوسط",-1),e("option",{value:"زیاد"},"زیاد",-1),e("option",{value:"فوری"},"فوری",-1)])],512),[[I,u.value.priority]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"label"},"درخواست",-1)),w(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>u.value.request=s),class:"input",rows:"4",required:""},null,512),[[S,u.value.request]])]),e("div",null,[t[47]||(t[47]=e("label",{class:"label"},"شرح اقدام",-1)),w(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=s=>u.value.actionDescription=s),class:"input",rows:"4"},null,512),[[S,u.value.actionDescription]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"label"},"شرح بستن",-1)),w(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>u.value.closeDescription=s),class:"input",rows:"3"},null,512),[[S,u.value.closeDescription]])]),e("div",ts,[e("button",{type:"submit",class:"btn btn-primary flex-1",disabled:d.value},"ذخیره",8,ss),e("button",{type:"button",onClick:G,class:"btn btn-secondary flex-1"},"انصراف")])],32)])):b("",!0),e("div",ls,[t[53]||(t[53]=e("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"اطلاعات",-1)),e("div",as,[e("div",null,[t[50]||(t[50]=e("label",{class:"text-gray-600"},"ایجاد کننده:",-1)),e("p",os,n((Z=o.value.createdBy)==null?void 0:Z.name),1)]),e("div",null,[t[51]||(t[51]=e("label",{class:"text-gray-600"},"آخرین ویرایش:",-1)),e("p",rs,n((ee=o.value.lastModifiedBy)==null?void 0:ee.name),1)]),e("div",null,[t[52]||(t[52]=e("label",{class:"text-gray-600"},"آخرین تغییر:",-1)),e("p",ns,n(R(o.value.updatedAt)),1)])])]),e("div",is,[e("div",us,[t[54]||(t[54]=e("h3",{class:"text-lg font-bold text-gray-900"},"تاریخچه تغییرات",-1)),e("button",{onClick:ce,class:"text-blue-600 hover:text-blue-900 text-sm"},n(p.value?"مخفی":"نمایش"),1)]),p.value?(a(),l("div",ds,[x.value?(a(),l("div",vs,[...t[55]||(t[55]=[e("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"},null,-1)])])):V.value.length===0?(a(),l("div",cs," تغییراتی ثبت نشده است ")):(a(),l("div",ms,[(a(!0),l(q,null,B(V.value,(s,j)=>{var P;return a(),l("div",{key:j,class:"border-b border-gray-200 pb-3 last:border-0"},[e("div",ps,[e("span",gs,n((P=s.modifiedBy)==null?void 0:P.name),1),e("span",ys,n(R(s.timestamp)),1)]),e("div",bs,[(a(!0),l(q,null,B(s.changedFields,(Y,be)=>(a(),l("div",{key:be},[e("span",fs,n(Y.field)+":",1),e("span",xs,n(Y.oldValue||"-"),1),t[56]||(t[56]=e("span",{class:"text-green-600 mr-2"},"→",-1)),e("span",ks,n(Y.newValue||"-"),1)]))),128))])])}),128))]))])):b("",!0)])])])])):(a(),l("div",ws,[...t[57]||(t[57]=[e("p",{class:"text-gray-500"},"درخواست یافت نشد",-1)])])),H(Ge,{"is-open":F.value,"onUpdate:isOpen":t[12]||(t[12]=s=>F.value=s),"image-url":oe.value},null,8,["is-open","image-url"])])}}};export{Ss as default};
