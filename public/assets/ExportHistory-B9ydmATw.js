import{y as f,r as y,k as H,c as r,a as t,t as l,f as z,I as F,d as D,j as P,F as U,p as Y,o as i,q as $}from"./index-NaxcUE6C.js";import{d as b}from"./dateUtils-B4onfrge.js";import{P as B}from"./PersianDatePicker-DxPeU3f5.js";import{S as h}from"./sweetalert2.esm.all-ePrzfkxH.js";const w={async getExportHistory(g={}){return(await f.get("/export-history",{params:g})).data},async getExportStatistics(){return(await f.get("/export-history/statistics")).data},async deleteExportHistory(g){return(await f.delete(`/export-history/${g}`)).data}},G={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},L={class:"card"},N={class:"flex items-center justify-between"},R={class:"text-3xl font-bold text-gray-900"},q={class:"card"},A={class:"flex items-center justify-between"},I={class:"text-3xl font-bold text-green-600"},K={class:"card"},J={class:"flex items-center justify-between"},O={class:"text-3xl font-bold text-red-600"},Q={class:"card"},W={class:"flex items-center justify-between"},X={class:"text-3xl font-bold text-blue-600"},Z={class:"card mb-6"},tt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},et={class:"card"},st={key:0,class:"text-center py-20"},at={key:1,class:"text-center py-20 text-gray-500"},ot={key:2,class:"overflow-x-auto"},lt={class:"min-w-full"},nt={class:"bg-white divide-y divide-gray-200"},rt={class:"px-6 py-4 whitespace-nowrap"},it={class:"badge badge-info"},dt={class:"px-6 py-4 text-sm text-gray-900"},ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},pt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ut={class:"px-6 py-4 whitespace-nowrap"},xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},vt={class:"px-6 py-4 whitespace-nowrap text-sm"},yt=["onClick"],mt={key:1,class:"text-gray-400"},ft={key:3,class:"mt-6 flex justify-between items-center"},bt={class:"text-sm text-gray-600"},ht={class:"flex gap-2"},wt=["disabled"],_t=["disabled"],Tt={__name:"ExportHistory",setup(g){const v=y(!1),m=y([]),u=y({total:0,successCount:0,failedCount:0,successRate:0}),o=y({page:1,limit:25,total:0,pages:1}),n=y({exportType:"",startDate:"",endDate:""}),k=s=>({excel:"Excel",csv:"CSV",advanced:"Ù¾ÛŒØ´Ø±ÙØªÙ‡"})[s]||s,T=s=>({success:"Ù…ÙˆÙÙ‚",failed:"Ù†Ø§Ù…ÙˆÙÙ‚",processing:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´"})[s]||s,S=s=>({success:"badge badge-success",failed:"badge badge-danger",processing:"badge badge-warning"})[s]||"badge badge-secondary",E=s=>s?b.formatDate(s,"jYYYY/jMM/jDD HH:mm"):"",j=s=>{if(!s||s===0)return"0 B";const e=1024,a=["B","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(e));return Math.round(s/Math.pow(e,d)*100)/100+" "+a[d]},_=s=>{o.value.page=s,c()},V=()=>{n.value={exportType:"",startDate:"",endDate:""},c()},M=async s=>{if((await h.fire({title:"Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ",text:"Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ú¯Ø´Øª Ù†ÛŒØ³Øª.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ú©Ù†",cancelButtonText:"Ù„ØºÙˆ",reverseButtons:!0})).isConfirmed)try{await w.deleteExportHistory(s),await h.fire({icon:"success",title:"Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²!",text:"Ø±Ú©ÙˆØ±Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.",confirmButtonText:"Ø¨Ø§Ø´Ù‡",confirmButtonColor:"#3085d6"}),await c(),await C()}catch(a){console.error("Error deleting history:",a),await h.fire({icon:"error",title:"Ø®Ø·Ø§!",text:"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯",confirmButtonText:"Ø¨Ø§Ø´Ù‡",confirmButtonColor:"#d33"})}},c=async()=>{var s,e,a,d;v.value=!0;try{const p={page:o.value.page,limit:o.value.limit};n.value.exportType&&(p.exportType=n.value.exportType),n.value.startDate&&(p.startDate=b.jalaliToGregorian(n.value.startDate)),n.value.endDate&&(p.endDate=b.jalaliToGregorian(n.value.endDate));const x=await w.getExportHistory(p);x.success&&(m.value=x.data||[],o.value={page:((s=x.pagination)==null?void 0:s.page)||1,limit:((e=x.pagination)==null?void 0:e.limit)||25,total:((a=x.pagination)==null?void 0:a.total)||0,pages:((d=x.pagination)==null?void 0:d.pages)||1})}catch(p){console.error("Error loading history:",p)}finally{v.value=!1}},C=async()=>{try{const s=await w.getExportStatistics();s.success&&(u.value=s.data||u.value)}catch(s){console.error("Error loading statistics:",s)}};return H(async()=>{await C(),await c()}),(s,e)=>(i(),r("div",null,[e[20]||(e[20]=t("div",{class:"mb-6 flex justify-between items-center"},[t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§"),t("p",{class:"text-gray-600 mt-2"},"Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù…ÛŒ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡")])],-1)),t("div",G,[t("div",L,[t("div",N,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-gray-600 text-sm mb-1"},"Ú©Ù„ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§",-1)),t("p",R,l(u.value.total||0),1)]),e[6]||(e[6]=t("div",{class:"p-4 rounded-2xl bg-blue-100"},[t("div",{class:"text-3xl"},"ðŸ“Š")],-1))])]),t("div",q,[t("div",A,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-gray-600 text-sm mb-1"},"Ù…ÙˆÙÙ‚",-1)),t("p",I,l(u.value.successCount||0),1)]),e[8]||(e[8]=t("div",{class:"p-4 rounded-2xl bg-green-100"},[t("div",{class:"text-3xl"},"âœ…")],-1))])]),t("div",K,[t("div",J,[t("div",null,[e[9]||(e[9]=t("p",{class:"text-gray-600 text-sm mb-1"},"Ù†Ø§Ù…ÙˆÙÙ‚",-1)),t("p",O,l(u.value.failedCount||0),1)]),e[10]||(e[10]=t("div",{class:"p-4 rounded-2xl bg-red-100"},[t("div",{class:"text-3xl"},"âŒ")],-1))])]),t("div",Q,[t("div",W,[t("div",null,[e[11]||(e[11]=t("p",{class:"text-gray-600 text-sm mb-1"},"Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª",-1)),t("p",X,l(u.value.successRate||0)+"%",1)]),e[12]||(e[12]=t("div",{class:"p-4 rounded-2xl bg-blue-100"},[t("div",{class:"text-3xl"},"ðŸ“ˆ")],-1))])])]),t("div",Z,[t("div",tt,[t("div",null,[e[14]||(e[14]=t("label",{class:"label"},"Ù†ÙˆØ¹ Ø®Ø±ÙˆØ¬ÛŒ",-1)),z(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.exportType=a),class:"input",onChange:c},[...e[13]||(e[13]=[t("option",{value:""},"Ù‡Ù…Ù‡",-1),t("option",{value:"excel"},"Excel",-1),t("option",{value:"csv"},"CSV",-1),t("option",{value:"advanced"},"Ù¾ÛŒØ´Ø±ÙØªÙ‡",-1)])],544),[[F,n.value.exportType]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"label"},"Ø§Ø² ØªØ§Ø±ÛŒØ®",-1)),D(B,{modelValue:n.value.startDate,"onUpdate:modelValue":[e[1]||(e[1]=a=>n.value.startDate=a),c],placeholder:"1403/01/01"},null,8,["modelValue"])]),t("div",null,[e[16]||(e[16]=t("label",{class:"label"},"ØªØ§ ØªØ§Ø±ÛŒØ®",-1)),D(B,{modelValue:n.value.endDate,"onUpdate:modelValue":[e[2]||(e[2]=a=>n.value.endDate=a),c],placeholder:"1403/12/29"},null,8,["modelValue"])]),t("div",{class:"flex items-end"},[t("button",{onClick:V,class:"btn btn-secondary w-full"},"Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†")])])]),t("div",et,[v.value?(i(),r("div",st,[...e[17]||(e[17]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1)])])):m.value.length===0?(i(),r("div",at,[...e[18]||(e[18]=[t("p",null,"Ø±Ú©ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯",-1)])])):(i(),r("div",ot,[t("table",lt,[e[19]||(e[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Ù†ÙˆØ¹"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Ù†Ø§Ù… ÙØ§ÛŒÙ„"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Ø­Ø¬Ù… ÙØ§ÛŒÙ„"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ÙˆØ¶Ø¹ÛŒØª"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ØªÙˆØ³Ø·"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ØªØ§Ø±ÛŒØ®"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Ø¹Ù…Ù„ÛŒØ§Øª")])],-1)),t("tbody",nt,[(i(!0),r(U,null,Y(m.value,a=>{var d;return i(),r("tr",{key:a._id,class:"hover:bg-gray-50"},[t("td",rt,[t("span",it,l(k(a.exportType)),1)]),t("td",dt,l(a.filename),1),t("td",ct,l(a.recordCount||0),1),t("td",pt,l(j(a.fileSize||0)),1),t("td",ut,[t("span",{class:$(S(a.status))},l(T(a.status)),3)]),t("td",xt,l(((d=a.exportedBy)==null?void 0:d.name)||"Ù†Ø§Ù…Ø´Ø®Øµ"),1),t("td",gt,l(E(a.createdAt)),1),t("td",vt,[a.status==="failed"?(i(),r("button",{key:0,onClick:p=>M(a._id),class:"text-red-600 hover:text-red-900"}," Ø­Ø°Ù ",8,yt)):(i(),r("span",mt,"-"))])])}),128))])])])),o.value.total>0?(i(),r("div",ft,[t("div",bt," Ù†Ù…Ø§ÛŒØ´ "+l((o.value.page-1)*o.value.limit+1)+" ØªØ§ "+l(Math.min(o.value.page*o.value.limit,o.value.total))+" Ø§Ø² "+l(o.value.total),1),t("div",ht,[t("button",{onClick:e[3]||(e[3]=a=>_(o.value.page-1)),disabled:o.value.page===1,class:"btn btn-secondary"}," Ù‚Ø¨Ù„ÛŒ ",8,wt),t("button",{onClick:e[4]||(e[4]=a=>_(o.value.page+1)),disabled:o.value.page>=o.value.pages,class:"btn btn-secondary"}," Ø¨Ø¹Ø¯ÛŒ ",8,_t)])])):P("",!0)])]))}};export{Tt as default};
