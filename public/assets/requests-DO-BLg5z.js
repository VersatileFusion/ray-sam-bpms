import{y as n,M as u}from"./index-NaxcUE6C.js";const o={async getRequests(e={}){return(await n.get("/requests",{params:e})).data},async searchRequests(e){return(await n.get("/requests/search",{params:e})).data},async getRequest(e){return(await n.get(`/requests/${e}`)).data},async createRequest(e){return(await n.post("/requests",e)).data},async updateRequest(e,s){return(await n.put(`/requests/${e}`,s)).data},async getRequestHistory(e){return(await n.get(`/requests/${e}/history`)).data},async addComment(e,s){return(await n.post(`/requests/${e}/comments`,{comment:s})).data},async uploadAttachment(e,s){const t=new FormData;return t.append("file",s),(await n.post(`/requests/${e}/attachments`,t,{headers:{"Content-Type":"multipart/form-data"}})).data},async assignRequest(e,s){return(await n.post(`/requests/${e}/assign`,{userId:s})).data},async bulkUpdate(e,s){return(await n.post("/requests/bulk/update",{ids:e,updates:s})).data}},h=u("requests",{state:()=>({requests:[],currentRequest:null,loading:!1,error:null,filters:{status:"",system:"",priority:"",date:""}}),getters:{filteredRequests:e=>{let s=e.requests;return e.filters.status&&(s=s.filter(t=>t.status===e.filters.status)),e.filters.system&&(s=s.filter(t=>t.system===e.filters.system)),e.filters.priority&&(s=s.filter(t=>t.priority===e.filters.priority)),s}},actions:{async fetchRequests(){var e,s;this.loading=!0,this.error=null;try{const t=await o.getRequests();return this.requests=t,t}catch(t){throw this.error=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"خطا در دریافت درخواست‌ها",t}finally{this.loading=!1}},async fetchRequest(e){var s,t;this.loading=!0,this.error=null;try{const r=await o.getRequest(e);return this.currentRequest=r,r}catch(r){throw this.error=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"خطا در دریافت درخواست",r}finally{this.loading=!1}},async createRequest(e){var s,t;this.loading=!0,this.error=null;try{const r=await o.createRequest(e);return await this.fetchRequests(),r}catch(r){throw this.error=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"خطا در ثبت درخواست",r}finally{this.loading=!1}},async updateRequest(e,s){var t,r,a;this.loading=!0,this.error=null;try{const i=await o.updateRequest(e,s);return await this.fetchRequests(),((t=this.currentRequest)==null?void 0:t._id)===e&&(this.currentRequest={...this.currentRequest,...s}),i}catch(i){throw this.error=((a=(r=i.response)==null?void 0:r.data)==null?void 0:a.message)||"خطا در ویرایش درخواست",i}finally{this.loading=!1}},async searchRequests(e){var s,t;this.loading=!0,this.error=null;try{return await o.searchRequests(e)}catch(r){throw this.error=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"خطا در جستجو",r}finally{this.loading=!1}},async assignRequest(e,s){var t,r;try{const a=await o.assignRequest(e,s);return await this.fetchRequests(),a}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"خطا در اختصاص درخواست",a}},async addComment(e,s){var t,r;try{return await o.addComment(e,s)}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"خطا در ثبت نظر",a}},async getRequestHistory(e){var s,t;try{return await o.getRequestHistory(e)}catch(r){throw this.error=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"خطا در دریافت تاریخچه",r}},async uploadAttachment(e,s){var t,r;try{return await o.uploadAttachment(e,s)}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"خطا در آپلود فایل",a}},setFilters(e){this.filters={...this.filters,...e}},clearFilters(){this.filters={status:"",system:"",priority:"",date:""}}}});export{h as u};
