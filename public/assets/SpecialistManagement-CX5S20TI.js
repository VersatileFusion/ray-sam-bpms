import{B as f,r as S,J as D,c as o,a as e,j as A,d as q,e as H,E as J,t as n,F as g,p as y,w as K,f as d,v as u,K as W,H as C,o as i,h as G,b as Q,q as R,O as X}from"./index-B1RxePN7.js";import{u as Z}from"./specialists-BivIS57Z.js";import{c as x,f as E,b as ee}from"./constants-CFvVWKro.js";const te={class:"space-y-6"},se={class:"flex flex-col gap-4 rounded-2xl border border-gray-100 bg-white/80 p-4 shadow-sm md:flex-row md:items-center md:justify-between md:p-6"},le={class:"flex flex-wrap items-center gap-2 sm:gap-3 md:justify-end"},ae=["disabled"],oe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4"},ie={class:"rounded-2xl border border-gray-100 bg-gradient-to-br from-white to-gray-50 p-5 shadow-sm"},re={class:"mt-3 text-3xl font-extrabold text-gray-900 md:text-4xl"},ne={class:"rounded-2xl border border-emerald-100 bg-gradient-to-br from-emerald-50 via-white to-white p-5 shadow-sm"},de={class:"mt-3 text-3xl font-extrabold text-emerald-700 md:text-4xl"},pe={class:"rounded-2xl border border-orange-100 bg-gradient-to-br from-orange-50 via-white to-white p-5 shadow-sm"},ue={class:"mt-3 text-3xl font-extrabold text-orange-700 md:text-4xl"},ce={class:"rounded-2xl border border-sky-100 bg-gradient-to-br from-sky-50 via-white to-white p-5 shadow-sm"},xe={class:"mt-3 text-3xl font-extrabold text-sky-700 md:text-4xl"},me={class:"rounded-2xl border border-gray-100 bg-white/80 shadow-sm"},be={key:0,class:"space-y-3 p-6"},ge={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4"},ye={class:"space-y-3"},fe={key:1,class:"overflow-x-auto rounded-2xl"},ve={class:"min-w-full divide-y divide-gray-100 text-sm"},we={class:"divide-y divide-gray-100 bg-white"},he={class:"px-6 py-4"},ke={class:"text-sm font-semibold text-gray-900"},_e={class:"text-xs text-gray-500"},Pe={class:"px-6 py-4 text-sm text-gray-700"},Se={class:"px-6 py-4"},Ae={class:"px-6 py-4 text-sm text-gray-700"},Ve={class:"px-6 py-4"},je={class:"flex flex-wrap gap-2"},Te={key:0,class:"text-xs text-gray-400"},Le={class:"px-6 py-4"},Ue=["onClick"],Be={key:0},Ce={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4"},Ee={class:"w-full max-w-2xl rounded-2xl bg-white p-6 shadow-xl"},Ie={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Me=["value"],Ye={class:"md:col-span-2 space-y-3"},Ne={class:"flex flex-wrap gap-2"},Fe=["value"],ze={class:"text-sm text-gray-700"},Oe={class:"md:col-span-2"},$e={class:"md:col-span-2"},De={class:"flex justify-end gap-3 border-t border-gray-100 pt-4"},qe=["disabled"],Ge={__name:"SpecialistManagement",setup(He){const v=Z(),m=f(()=>v.items),w=f(()=>v.loading),h=S(!1),k=S(null),b=S(""),l=D({role:"specialist",name:"",email:"",phone:"",jobTitle:"",department:"",skills:[],specialistProfile:{status:x.AVAILABLE,capacity:5,experienceYears:0,systems:[],notes:""}}),V=async()=>{await v.fetchSpecialists()},I=a=>{switch(a){case x.AVAILABLE:return"badge-success";case x.BUSY:return"badge-warning";case x.AWAY:return"badge-secondary";default:return"badge-secondary"}},M=a=>E[a]||"نامشخص",Y=f(()=>m.value.filter(a=>{var t;return((t=a.specialistProfile)==null?void 0:t.status)===x.AVAILABLE}).length),N=f(()=>m.value.filter(a=>{var t;return((t=a.specialistProfile)==null?void 0:t.status)===x.BUSY}).length),F=f(()=>{const a=m.value.map(t=>{var r,c;const p=((r=t.specialistProfile)==null?void 0:r.capacity)||0,s=((c=t.specialistProfile)==null?void 0:c.workload)||0;return p>0?s/p:0}).filter(t=>t>0);return a.length?Math.round(a.reduce((t,p)=>t+p,0)/a.length*100):0}),z=()=>{k.value=null,Object.assign(l,{role:"specialist",name:"",email:"",phone:"",jobTitle:"",department:"",skills:[],specialistProfile:{status:x.AVAILABLE,capacity:5,experienceYears:0,systems:[],notes:""}}),b.value=""},O=a=>{var t,p,s,r,c;k.value=a,Object.assign(l,{role:"specialist",name:a.name,email:a.email,phone:a.phone,jobTitle:a.jobTitle,department:a.department,skills:a.skills||[],specialistProfile:{status:((t=a.specialistProfile)==null?void 0:t.status)||x.AVAILABLE,capacity:((p=a.specialistProfile)==null?void 0:p.capacity)??5,experienceYears:((s=a.specialistProfile)==null?void 0:s.experienceYears)??0,systems:[...((r=a.specialistProfile)==null?void 0:r.systems)||[]],notes:((c=a.specialistProfile)==null?void 0:c.notes)||""}}),b.value=(l.skills||[]).join(", "),h.value=!0},_=()=>{h.value=!1,z()},$=async()=>{const a={name:l.name,email:l.email,phone:l.phone,jobTitle:l.jobTitle,department:l.department,role:"specialist",skills:b.value?b.value.split(",").map(t=>t.trim()).filter(Boolean):[],specialistProfile:l.specialistProfile};await v.updateProfile(k.value._id,a),_()};return V(),(a,t)=>{const p=J("router-link");return i(),o("div",te,[e("section",se,[t[12]||(t[12]=e("div",null,[e("p",{class:"text-xs font-semibold uppercase tracking-widest text-primary-500"}," مدیریت متخصصین "),e("h1",{class:"mt-2 text-2xl font-extrabold text-gray-900 md:text-3xl"}," تیم پشتیبانی "),e("p",{class:"mt-1 text-sm text-gray-600 md:text-base"}," مدیریت وضعیت، ظرفیت و حوزه مهارت متخصصین پشتیبانی ")],-1)),e("div",le,[q(p,{class:"btn btn-light",to:"/admin/users"},{default:H(()=>[...t[11]||(t[11]=[G(" ایجاد متخصص جدید ",-1)])]),_:1}),e("button",{class:"btn btn-secondary",onClick:V,disabled:w.value}," بروزرسانی ",8,ae)])]),e("section",oe,[e("article",ie,[t[13]||(t[13]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-gray-500"},"تعداد کل متخصصین",-1)),e("p",re,n(m.value.length),1)]),e("article",ne,[t[14]||(t[14]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-emerald-600"},"آماده به کار",-1)),e("p",de,n(Y.value),1)]),e("article",pe,[t[15]||(t[15]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-orange-600"},"مشغول",-1)),e("p",ue,n(N.value),1)]),e("article",ce,[t[16]||(t[16]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-sky-600"},"میانگین بهره‌وری",-1)),e("p",xe,n(F.value)+"%",1)])]),e("section",me,[w.value?(i(),o("div",be,[e("div",ge,[(i(),o(g,null,y(4,s=>e("div",{key:`specialist-summary-${s}`,class:"animate-pulse rounded-2xl border border-gray-100 bg-gray-50/60 p-5"},[...t[17]||(t[17]=[e("div",{class:"h-3 w-16 rounded bg-gray-200"},null,-1),e("div",{class:"mt-3 h-6 w-24 rounded bg-gray-200"},null,-1)])])),64))]),e("div",ye,[(i(),o(g,null,y(5,s=>e("div",{key:`specialist-row-${s}`,class:"animate-pulse space-y-3 rounded-xl border border-gray-100 bg-gray-50/60 p-4"},[...t[18]||(t[18]=[Q('<div class="flex flex-wrap justify-between gap-2"><div class="h-4 w-32 rounded bg-gray-200"></div><div class="h-4 w-20 rounded bg-gray-200"></div></div><div class="h-3 w-3/4 rounded bg-gray-200"></div><div class="flex gap-2"><div class="h-6 w-16 rounded-full bg-gray-200"></div><div class="h-6 w-20 rounded-full bg-gray-200"></div><div class="h-6 w-24 rounded-full bg-gray-200"></div></div>',3)])])),64))])])):(i(),o("div",fe,[e("table",ve,[t[20]||(t[20]=e("thead",{class:"bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-500"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right"},"نام"),e("th",{class:"px-6 py-3 text-right"},"سمت"),e("th",{class:"px-6 py-3 text-right"},"وضعیت"),e("th",{class:"px-6 py-3 text-right"},"ظرفیت"),e("th",{class:"px-6 py-3 text-right"},"سیستم‌ها"),e("th",{class:"px-6 py-3 text-right"},"عملیات")])],-1)),e("tbody",we,[(i(!0),o(g,null,y(m.value,s=>{var r,c,j,T,L,U,B;return i(),o("tr",{key:s._id,class:"transition hover:bg-gray-50"},[e("td",he,[e("p",ke,n(s.name),1),e("p",_e,n(s.email||s.username),1)]),e("td",Pe,n(s.jobTitle||"—"),1),e("td",Se,[e("span",{class:R(["badge",I((r=s.specialistProfile)==null?void 0:r.status)])},n(M((c=s.specialistProfile)==null?void 0:c.status)),3)]),e("td",Ae,n(((j=s.specialistProfile)==null?void 0:j.workload)||0)+" / "+n(((T=s.specialistProfile)==null?void 0:T.capacity)||0),1),e("td",Ve,[e("div",je,[(i(!0),o(g,null,y(((L=s.specialistProfile)==null?void 0:L.systems)||[],P=>(i(),o("span",{key:P,class:"badge badge-outline"},n(P),1))),128)),(B=(U=s.specialistProfile)==null?void 0:U.systems)!=null&&B.length?A("",!0):(i(),o("span",Te," مشخص نشده "))])]),e("td",Le,[e("button",{class:"text-indigo-600 hover:text-indigo-700",onClick:P=>O(s)}," ویرایش ",8,Ue)])])}),128)),m.value.length?A("",!0):(i(),o("tr",Be,[...t[19]||(t[19]=[e("td",{colspan:"6",class:"px-6 py-12 text-center text-sm text-gray-500"}," متخصصی ثبت نشده است. از بخش مدیریت کاربران متخصص جدیدی ایجاد کنید. ",-1)])]))])])]))]),h.value?(i(),o("div",Ce,[e("div",Ee,[e("div",{class:"flex items-center justify-between border-b border-gray-100 pb-4"},[t[21]||(t[21]=e("h2",{class:"text-2xl font-bold text-gray-900"},"ویرایش متخصص",-1)),e("button",{class:"text-gray-400 transition hover:text-gray-600",onClick:_,"aria-label":"بستن"}," ✕ ")]),e("form",{onSubmit:K($,["prevent"]),class:"mt-6 space-y-6 overflow-y-auto max-h-[70vh] pr-1"},[e("div",Ie,[e("div",null,[t[22]||(t[22]=e("label",{class:"label"},"نام",-1)),d(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.name=s),type:"text",class:"input"},null,512),[[u,l.name]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"label"},"ایمیل",-1)),d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.email=s),type:"email",class:"input"},null,512),[[u,l.email]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"label"},"شماره تماس",-1)),d(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.phone=s),type:"text",class:"input"},null,512),[[u,l.phone]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"label"},"سمت",-1)),d(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.jobTitle=s),type:"text",class:"input"},null,512),[[u,l.jobTitle]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"label"},"دپارتمان",-1)),d(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.department=s),type:"text",class:"input"},null,512),[[u,l.department]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"label"},"وضعیت",-1)),d(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.specialistProfile.status=s),class:"input"},[(i(!0),o(g,null,y(C(E),(s,r)=>(i(),o("option",{key:r,value:r},n(s),9,Me))),128))],512),[[W,l.specialistProfile.status]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"label"},"ظرفیت",-1)),d(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.specialistProfile.capacity=s),type:"number",min:"0",class:"input"},null,512),[[u,l.specialistProfile.capacity,void 0,{number:!0}]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"label"},"تجربه (سال)",-1)),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.specialistProfile.experienceYears=s),type:"number",min:"0",class:"input"},null,512),[[u,l.specialistProfile.experienceYears,void 0,{number:!0}]])]),e("div",Ye,[t[30]||(t[30]=e("label",{class:"label m-0"},"سیستم‌های تخصصی",-1)),e("div",Ne,[(i(!0),o(g,null,y(C(ee),s=>(i(),o("label",{key:s,class:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2"},[d(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[8]||(t[8]=r=>l.specialistProfile.systems=r)},null,8,Fe),[[X,l.specialistProfile.systems]]),e("span",ze,n(s),1)]))),128))])]),e("div",Oe,[t[31]||(t[31]=e("label",{class:"label"},"مهارت‌ها",-1)),d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>b.value=s),type:"text",class:"input",placeholder:"هر مهارت را با کاما جدا کنید"},null,512),[[u,b.value]])]),e("div",$e,[t[32]||(t[32]=e("label",{class:"label"},"یادداشت",-1)),d(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=s=>l.specialistProfile.notes=s),class:"input h-24"},null,512),[[u,l.specialistProfile.notes]])])]),e("div",De,[e("button",{type:"button",class:"btn btn-light",onClick:_}," انصراف "),e("button",{type:"submit",class:"btn btn-primary",disabled:w.value}," ذخیره تغییرات ",8,qe)])],32)])])):A("",!0)])}}};export{Ge as default};
