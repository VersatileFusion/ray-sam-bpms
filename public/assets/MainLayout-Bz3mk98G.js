import{_ as F,i as V,r as m,k as K,l as G,m as _,o as r,d as p,e as d,c as i,j as y,w as E,a as t,f as U,n as T,v as H,F as P,p as J,q as R,t as f,T as W,s as X,x as Z,y as Q,u as ee,z as te,A as M,B as O,h as c,C as z,D as re}from"./index-NaxcUE6C.js";import{u as se}from"./notifications-Dl6frOdJ.js";import{d as oe}from"./dateUtils-B4onfrge.js";import{S as q}from"./constants-CjjkXsVG.js";const ae={class:"p-4 border-b border-gray-200 dark:border-gray-700"},ne={class:"relative"},le=["onKeydown"],ie={class:"max-h-[60vh] overflow-y-auto"},de={key:0,class:"p-8 text-center"},ue={key:1,class:"p-8 text-center text-gray-500 dark:text-gray-400"},ce={key:2,class:"p-8 text-center text-gray-500 dark:text-gray-400"},ve={key:3,class:"divide-y divide-gray-200 dark:divide-gray-700"},ge=["onClick","onMouseenter"],pe={class:"flex items-start space-x-3 space-x-reverse"},ye={class:"flex-shrink-0"},xe={class:"flex-1 min-w-0"},me={class:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate"},fe={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},ke={class:"p-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},he={key:0},be={__name:"GlobalSearch",setup(A,{expose:S}){const k=V(),x=m(!1),v=m(""),l=m([]),h=m(!1),o=m(-1),j=m(null),C=s=>({[q.OPEN]:"badge badge-info",[q.IN_PROGRESS]:"badge badge-warning",[q.COMPLETED]:"badge badge-success"})[s]||"badge badge-secondary",D=s=>s?oe.formatDate(s,"jYYYY/jMM/jDD"):"",$=(s,n)=>{if(!n.trim())return s;const u=new RegExp(`(${n})`,"gi");return s.replace(u,'<mark class="bg-yellow-200 dark:bg-yellow-800">$1</mark>')},B=async()=>{if(!v.value.trim()){l.value=[];return}h.value=!0;try{const s=await Q.get("/requests/search",{params:{q:v.value,limit:10}});s.data.success&&(l.value=s.data.data||[],o.value=-1)}catch(s){console.error("Search error:",s),l.value=[]}finally{h.value=!1}},L=()=>{o.value>=0&&l.value[o.value]?e(l.value[o.value]):l.value.length>0&&e(l.value[0])},N=()=>{o.value<l.value.length-1&&o.value++},w=()=>{o.value>0&&o.value--},e=s=>{b(),k.push(`/requests/${s._id}`)},a=()=>{x.value=!0,v.value="",l.value=[],Z(()=>{var s;(s=j.value)==null||s.focus()})},b=()=>{x.value=!1,v.value="",l.value=[],o.value=-1},g=s=>{(s.metaKey||s.ctrlKey)&&s.key==="k"&&(s.preventDefault(),x.value?b():a())};return K(()=>{document.addEventListener("keydown",g)}),G(()=>{document.removeEventListener("keydown",g)}),S({open:a,close:b}),(s,n)=>(r(),_(X,{to:"body"},[p(W,{name:"fade"},{default:d(()=>[x.value?(r(),i("div",{key:0,class:"fixed inset-0 z-[9999] flex items-start justify-center pt-[20vh] px-4",onClick:E(b,["self"])},[t("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl border border-gray-200 dark:border-gray-700",onClick:n[1]||(n[1]=E(()=>{},["stop"]))},[t("div",ae,[t("div",ne,[U(t("input",{ref_key:"searchInput",ref:j,"onUpdate:modelValue":n[0]||(n[0]=u=>v.value=u),type:"text",placeholder:"جستجوی درخواست‌ها، مشتری‌ها، سیستم‌ها...",class:"w-full px-4 py-3 pr-12 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500",onInput:B,onKeydown:[T(b,["esc"]),T(L,["enter"]),T(E(N,["prevent"]),["down"]),T(E(w,["prevent"]),["up"])]},null,40,le),[[H,v.value]]),n[2]||(n[2]=t("div",{class:"absolute right-3 top-1/2 transform -translate-y-1/2"},[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),t("div",ie,[h.value?(r(),i("div",de,[...n[3]||(n[3]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])])):v.value.trim()?l.value.length===0?(r(),i("div",ce,[...n[5]||(n[5]=[t("p",null,"نتیجه‌ای یافت نشد",-1)])])):(r(),i("div",ve,[(r(!0),i(P,null,J(l.value,(u,I)=>(r(),i("div",{key:u._id,class:R(["p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",o.value===I?"bg-gray-50 dark:bg-gray-700":""]),onClick:Y=>e(u),onMouseenter:Y=>o.value=I},[t("div",pe,[t("div",ye,[t("span",{class:R([C(u.status),"badge"])},f(u.status),3)]),t("div",xe,[t("p",me,f($(u.request||"",v.value)),1),t("p",fe,f(u.customerName)+" • "+f(u.system)+" • "+f(D(u.date)),1)])])],42,ge))),128))])):(r(),i("div",ue,[...n[4]||(n[4]=[t("p",null,"برای جستجو تایپ کنید...",-1),t("p",{class:"text-xs mt-2"},"می‌توانید از کلیدهای میانبر استفاده کنید",-1)])]))]),t("div",ke,[n[6]||(n[6]=t("div",{class:"flex items-center space-x-4 space-x-reverse"},[t("span",null,"↑↓ برای حرکت"),t("span",null,"Enter برای انتخاب"),t("span",null,"Esc برای بستن")],-1)),l.value.length>0?(r(),i("span",he,f(l.value.length)+" نتیجه",1)):y("",!0)])])])):y("",!0)]),_:1})]))}},we=F(be,[["__scopeId","data-v-ed4a9ddd"]]),_e={class:"bg-white shadow-lg border-b border-gray-100 sticky top-0 z-50 backdrop-blur-sm bg-white/95"},$e={class:"container mx-auto px-4"},Ce={class:"flex items-center justify-between h-16"},Me={class:"flex items-center space-x-8 space-x-reverse"},Se={class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},je={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"},De={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},Be={class:"hidden md:flex items-center space-x-6 space-x-reverse"},Ee={key:0,class:"md:hidden absolute top-16 left-0 right-0 bg-white dark:bg-gray-800 shadow-lg border-t border-gray-200 dark:border-gray-700 z-40"},Te={class:"px-4 py-4 space-y-2"},ze={class:"flex items-center space-x-2 sm:space-x-4 space-x-reverse"},Le={key:0,class:"absolute top-0 right-0 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse shadow-md"},Ne=["title"],qe={key:0,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ae={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ie={class:"relative group"},Re={class:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold shadow-md hover:shadow-lg transition-shadow"},Ve={class:"hidden md:block text-gray-700"},Ke={class:"absolute left-0 mt-2 w-48 bg-white rounded-xl shadow-2xl py-2 z-50 border border-gray-100 animate-fade-in-down"},Ue={__name:"Header",setup(A){const S=V(),k=ee(),x=se(),{isDark:v,toggleDarkMode:l}=te(),h=m(!1),o=m(!1),j=m(null),C=M(()=>k.user),D=M(()=>k.isAdmin),$=M(()=>k.isCustomer),B=M(()=>x.unreadCount),L=M(()=>{var e;return(e=C.value)!=null&&e.name?C.value.name.split(" ").map(a=>a[0]).join("").toUpperCase():"?"}),N=async()=>{try{await k.logout(),S.push("/login")}catch(w){console.error("Logout error:",w)}};return K(async()=>{if(k.user)try{await x.fetchNotifications()}catch(w){console.error("Failed to fetch notifications:",w)}}),(w,e)=>{var b;const a=O("router-link");return r(),i("header",_e,[t("div",$e,[t("div",Ce,[t("div",Me,[p(a,{to:"/",class:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent hover:scale-105 transition-transform duration-200"},{default:d(()=>[...e[8]||(e[8]=[c(" سیستم مدیریت درخواست‌ها ",-1)])]),_:1}),t("button",{onClick:e[0]||(e[0]=g=>o.value=!o.value),class:"md:hidden p-2 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400"},[(r(),i("svg",Se,[o.value?(r(),i("path",De)):(r(),i("path",je))]))]),t("nav",Be,[p(a,{to:"/",class:"text-gray-700 hover:text-primary-600 transition-colors","active-class":"text-primary-600 font-medium"},{default:d(()=>[...e[9]||(e[9]=[c(" داشبورد ",-1)])]),_:1}),p(a,{to:"/requests",class:"text-gray-700 hover:text-primary-600 transition-colors","active-class":"text-primary-600 font-medium"},{default:d(()=>[...e[10]||(e[10]=[c(" درخواست‌ها ",-1)])]),_:1}),$.value?y("",!0):(r(),_(a,{key:0,to:"/reports",class:"text-gray-700 hover:text-primary-600 transition-colors","active-class":"text-primary-600 font-medium"},{default:d(()=>[...e[11]||(e[11]=[c(" گزارش‌ها ",-1)])]),_:1})),$.value?y("",!0):(r(),_(a,{key:1,to:"/scheduled-reports",class:"text-gray-700 hover:text-primary-600 transition-colors","active-class":"text-primary-600 font-medium"},{default:d(()=>[...e[12]||(e[12]=[c(" گزارش‌های زمان‌بندی ",-1)])]),_:1})),$.value?y("",!0):(r(),_(a,{key:2,to:"/export-history",class:"text-gray-700 hover:text-primary-600 transition-colors","active-class":"text-primary-600 font-medium"},{default:d(()=>[...e[13]||(e[13]=[c(" تاریخچه خروجی ",-1)])]),_:1})),D.value?(r(),_(a,{key:3,to:"/admin/users",class:"text-gray-700 hover:text-primary-600 transition-colors","active-class":"text-primary-600 font-medium"},{default:d(()=>[...e[14]||(e[14]=[c(" مدیریت کاربران ",-1)])]),_:1})):y("",!0)]),o.value?(r(),i("nav",Ee,[t("div",Te,[p(a,{to:"/",class:"block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:e[1]||(e[1]=g=>o.value=!1)},{default:d(()=>[...e[15]||(e[15]=[c(" داشبورد ",-1)])]),_:1}),p(a,{to:"/requests",class:"block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:e[2]||(e[2]=g=>o.value=!1)},{default:d(()=>[...e[16]||(e[16]=[c(" درخواست‌ها ",-1)])]),_:1}),$.value?y("",!0):(r(),_(a,{key:0,to:"/reports",class:"block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:e[3]||(e[3]=g=>o.value=!1)},{default:d(()=>[...e[17]||(e[17]=[c(" گزارش‌ها ",-1)])]),_:1})),D.value?(r(),_(a,{key:1,to:"/admin/users",class:"block px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:e[4]||(e[4]=g=>o.value=!1)},{default:d(()=>[...e[18]||(e[18]=[c(" مدیریت کاربران ",-1)])]),_:1})):y("",!0)])])):y("",!0)]),t("div",ze,[p(we,{ref_key:"globalSearchRef",ref:j},null,512),p(a,{to:"/notifications",class:"relative p-2 text-gray-700 hover:text-primary-600 transition-all duration-200 rounded-lg hover:bg-gray-100 transform hover:scale-110"},{default:d(()=>[e[19]||(e[19]=t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),B.value>0?(r(),i("span",Le,f(B.value),1)):y("",!0)]),_:1}),t("button",{onClick:e[5]||(e[5]=(...g)=>z(l)&&z(l)(...g)),class:"p-2 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transform hover:scale-110",title:z(v)?"روشن":"تاریک"},[z(v)?(r(),i("svg",qe,[...e[20]||(e[20]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"},null,-1)])])):(r(),i("svg",Ae,[...e[21]||(e[21]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"},null,-1)])]))],8,Ne),t("div",Ie,[t("button",{class:"flex items-center space-x-2 space-x-reverse focus:outline-none hover:scale-105 transition-transform duration-200",onClick:e[6]||(e[6]=g=>h.value=!h.value)},[t("div",Re,f(L.value),1),t("span",Ve,f((b=C.value)==null?void 0:b.name),1)]),U(t("div",Ke,[p(a,{to:"/profile",class:"block px-4 py-2 text-gray-700 hover:bg-gray-100",onClick:e[7]||(e[7]=g=>h.value=!1)},{default:d(()=>[...e[22]||(e[22]=[c(" پروفایل ",-1)])]),_:1}),t("button",{onClick:N,class:"block w-full text-right px-4 py-2 text-red-600 hover:bg-gray-100"}," خروج ")],512),[[re,h.value]])])])])])])}}},Oe={class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200"},Ye={class:"container mx-auto px-2 sm:px-4 py-4 sm:py-6"},Je={__name:"MainLayout",setup(A){return(S,k)=>{const x=O("router-view");return r(),i("div",Oe,[p(Ue),t("div",Ye,[p(x)])])}}};export{Je as default};
