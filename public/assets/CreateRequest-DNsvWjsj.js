import{r as f,k as R,c as u,o as r,a as l,f as n,I as V,F as U,p as w,t as g,y as P,u as j,A as E,w as M,j as b,d as k,h as i,v as y,C,i as A,J as B}from"./index-NaxcUE6C.js";import{u as I}from"./requests-DO-BLg5z.js";import{a as G,R as J}from"./constants-CjjkXsVG.js";import{d as S}from"./dateUtils-B4onfrge.js";import{P as F}from"./PersianDatePicker-DxPeU3f5.js";const L=["value"],Y={__name:"RequestTemplateSelector",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","template-applied"],setup(N,{emit:T}){const D=N,c=T,x=f([]),v=f(D.modelValue),d=f(!1),m=async()=>{d.value=!0;try{const o=await P.get("/request-templates");o.data.success&&(x.value=o.data.templates||[])}catch(o){console.error("Error loading templates:",o)}finally{d.value=!1}},q=async()=>{if(!v.value){c("template-applied",null);return}try{const o=await P.get(`/request-templates/${v.value}`);o.data.success&&(c("template-applied",o.data.template),c("update:modelValue",v.value))}catch(o){console.error("Error loading template:",o)}};return R(()=>{m()}),(o,s)=>(r(),u("div",null,[s[2]||(s[2]=l("label",{class:"label"},"استفاده از الگو (اختیاری)",-1)),n(l("select",{"onUpdate:modelValue":s[0]||(s[0]=p=>v.value=p),class:"input",onChange:q},[s[1]||(s[1]=l("option",{value:""},"بدون الگو",-1)),(r(!0),u(U,null,w(x.value,p=>(r(),u("option",{key:p._id,value:p._id},g(p.name)+" - "+g(p.system),9,L))),128))],544),[[V,v.value]])]))}},Q={class:"flex justify-center"},z={class:"w-full max-w-4xl"},H={class:"card"},K={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6"},O={key:1,class:"mb-6"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},X=["disabled"],Z=["value"],_=["value"],h={key:0},ee={key:1},le={class:"mt-6"},se={key:2,class:"mt-6"},te={key:3,class:"mt-6"},ae={class:"flex justify-end space-x-4 space-x-reverse mt-8"},oe=["disabled"],ue=["disabled"],re={key:0,class:"mr-2"},me={__name:"CreateRequest",setup(N){const T=A(),D=I(),c=j(),{success:x,error:v}=B(),d=f(!1),m=f(""),q=E(()=>c.user),o=E(()=>{var a;return((a=q.value)==null?void 0:a.role)==="customer"}),s=f({date:S.getCurrentJalaliDate(),customerName:"",customerPhone:"",userName:"",system:"",request:"",requestType:"",actionDescription:"",closeDescription:"",status:"باز",priority:"متوسط",dueDate:""});R(()=>{var a;(a=q.value)!=null&&a.name&&(s.value.customerName=q.value.name)});const p=async()=>{var a,e;m.value="",d.value=!0;try{let t={...s.value,date:S.jalaliToGregorian(s.value.date)};o.value||(t.dueDate=s.value.dueDate?S.jalaliToGregorian(s.value.dueDate):void 0),await D.createRequest(t),x("درخواست با موفقیت ثبت شد"),T.push("/requests")}catch(t){m.value=((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"خطا در ثبت درخواست",v(m.value)}finally{d.value=!1}},$=a=>{a&&(a.defaultFields&&(a.defaultFields.request&&(s.value.request=a.defaultFields.request),a.defaultFields.actionDescription&&(s.value.actionDescription=a.defaultFields.actionDescription)),a.system&&(s.value.system=a.system),a.requestType&&(s.value.requestType=a.requestType),a.defaultPriority&&(s.value.priority=a.defaultPriority),x(`الگوی "${a.name}" اعمال شد`))};return(a,e)=>(r(),u("div",Q,[l("div",z,[e[31]||(e[31]=l("div",{class:"mb-6"},[l("h1",{class:"text-3xl font-bold text-gray-900"},"ثبت درخواست جدید"),l("p",{class:"text-gray-600 mt-2"},"فرم ثبت درخواست جدید")],-1)),l("div",H,[l("form",{onSubmit:M(p,["prevent"])},[m.value?(r(),u("div",K,g(m.value),1)):b("",!0),o.value?b("",!0):(r(),u("div",O,[k(Y,{onTemplateApplied:$})])),l("div",W,[l("div",null,[e[13]||(e[13]=l("label",{class:"label"},[i("تاریخ "),l("span",{class:"text-red-500"},"*")],-1)),k(F,{modelValue:s.value.date,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.date=t),placeholder:"1403/08/15"},null,8,["modelValue"])]),l("div",null,[e[14]||(e[14]=l("label",{class:"label"},[i("نام مشتری "),l("span",{class:"text-red-500"},"*")],-1)),n(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.customerName=t),type:"text",class:"input",placeholder:"نام مشتری",required:"",disabled:o.value},null,8,X),[[y,s.value.customerName]])]),l("div",null,[e[15]||(e[15]=l("label",{class:"label"},[i("شماره تماس "),l("span",{class:"text-red-500"},"*")],-1)),n(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.customerPhone=t),type:"tel",class:"input",placeholder:"09123456789",required:""},null,512),[[y,s.value.customerPhone]])]),l("div",null,[e[16]||(e[16]=l("label",{class:"label"},[i("نام کاربر "),l("span",{class:"text-red-500"},"*")],-1)),n(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.userName=t),type:"text",class:"input",placeholder:"نام کاربر",required:""},null,512),[[y,s.value.userName]])]),l("div",null,[e[18]||(e[18]=l("label",{class:"label"},[i("سیستم "),l("span",{class:"text-red-500"},"*")],-1)),n(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.system=t),class:"input",required:""},[e[17]||(e[17]=l("option",{value:""},"انتخاب کنید",-1)),(r(!0),u(U,null,w(C(G),t=>(r(),u("option",{key:t,value:t},g(t),9,Z))),128))],512),[[V,s.value.system]])]),l("div",null,[e[20]||(e[20]=l("label",{class:"label"},[i("نوع درخواست "),l("span",{class:"text-red-500"},"*")],-1)),n(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.requestType=t),class:"input",required:""},[e[19]||(e[19]=l("option",{value:""},"انتخاب کنید",-1)),(r(!0),u(U,null,w(C(J),t=>(r(),u("option",{key:t,value:t},g(t),9,_))),128))],512),[[V,s.value.requestType]])]),o.value?b("",!0):(r(),u("div",h,[e[22]||(e[22]=l("label",{class:"label"},[i("وضعیت "),l("span",{class:"text-red-500"},"*")],-1)),n(l("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.status=t),class:"input",required:""},[...e[21]||(e[21]=[l("option",{value:""},"انتخاب کنید",-1),l("option",{value:"باز"},"باز",-1),l("option",{value:"در درست اقدام"},"در درست اقدام",-1),l("option",{value:"انجام"},"انجام",-1)])],512),[[V,s.value.status]])])),l("div",null,[e[24]||(e[24]=l("label",{class:"label"},"اولویت",-1)),n(l("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.priority=t),class:"input"},[...e[23]||(e[23]=[l("option",{value:"متوسط"},"متوسط",-1),l("option",{value:"کم"},"کم",-1),l("option",{value:"زیاد"},"زیاد",-1),l("option",{value:"فوری"},"فوری",-1)])],512),[[V,s.value.priority]])]),o.value?b("",!0):(r(),u("div",ee,[e[25]||(e[25]=l("label",{class:"label"},"تاریخ سررسید",-1)),k(F,{modelValue:s.value.dueDate,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.dueDate=t),placeholder:"1403/09/01"},null,8,["modelValue"])]))]),l("div",le,[e[26]||(e[26]=l("label",{class:"label"},[i("درخواست "),l("span",{class:"text-red-500"},"*")],-1)),n(l("textarea",{"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.request=t),class:"input",rows:"4",placeholder:"توضیحات درخواست",required:""},null,512),[[y,s.value.request]])]),o.value?b("",!0):(r(),u("div",se,[e[27]||(e[27]=l("label",{class:"label"},[i("شرح اقدام "),l("span",{class:"text-red-500"},"*")],-1)),n(l("textarea",{"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.actionDescription=t),class:"input",rows:"4",placeholder:"شرح اقدامات انجام شده",required:""},null,512),[[y,s.value.actionDescription]])])),o.value?b("",!0):(r(),u("div",te,[e[28]||(e[28]=l("label",{class:"label"},"شرح بستن درخواست",-1)),n(l("textarea",{"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.closeDescription=t),class:"input",rows:"3",placeholder:"شرح بستن درخواست (اختیاری)"},null,512),[[y,s.value.closeDescription]])])),l("div",ae,[l("button",{type:"button",onClick:e[12]||(e[12]=t=>a.$router.push("/requests")),class:"btn btn-secondary",disabled:d.value}," انصراف ",8,oe),l("button",{type:"submit",class:"btn btn-primary",disabled:d.value},[d.value?(r(),u("span",re,[...e[29]||(e[29]=[l("span",{class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):b("",!0),e[30]||(e[30]=i(" ثبت درخواست ",-1))],8,ue)])],32)])])]))}};export{me as default};
